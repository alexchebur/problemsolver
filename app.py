import streamlit as st
import google.generativeai as genai
import base64
import time

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
api_key = st.secrets.get('GEMINI_API_KEY')
if not api_key:
    st.error("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GEMINI_API_KEY –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö Streamlit")
    st.stop()

genai.configure(api_key=api_key)

# –§—Ä–∞–≥–º–µ–Ω—Ç—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π –∞–≤—Ç–æ—Ä–æ–≤ –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
AUTHOR_STYLES = {
    "tolstoy": {
        "name": "–õ.–ù. –¢–æ–ª—Å—Ç–æ–π",
        "fragment": """
–§—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ "–í–æ–π–Ω—ã –∏ –º–∏—Ä–∞":
¬´–ò, –æ—Ç–¥–µ–ª–∞–≤—à–∏—Å—å –æ—Ç –º–æ–ª–æ–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –Ω–µ —É–º–µ—é—â–µ–≥–æ –∂–∏—Ç—å, –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∏–ª–∞—Å—å –∫ —Å–≤–æ–∏–º –∑–∞–Ω—è—Ç–∏—è–º —Ö–æ–∑—è–π–∫–∏ –¥–æ–º–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞ –ø—Ä–∏—Å–ª—É—à–∏–≤–∞—Ç—å—Å—è –∏ –ø—Ä–∏–≥–ª—è–¥—ã–≤–∞—Ç—å—Å—è, –≥–æ—Ç–æ–≤–∞—è –ø–æ–¥–∞—Ç—å –ø–æ–º–æ—â—å –Ω–∞ —Ç–æ—Ç –ø—É–Ω–∫—Ç, –≥–¥–µ –æ—Å–ª–∞–±–µ–≤–∞–ª —Ä–∞–∑–≥–æ–≤–æ—Ä. –ö–∞–∫ —Ö–æ–∑—è–∏–Ω –ø—Ä—è–¥–∏–ª—å–Ω–æ–π –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π, –ø–æ—Å–∞–¥–∏–≤ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –ø–æ –º–µ—Å—Ç–∞–º, –ø—Ä–æ—Ö–∞–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—é, –∑–∞–º–µ—á–∞—è –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å –∏–ª–∏ –Ω–µ–ø—Ä–∏–≤—ã—á–Ω—ã–π, —Å–∫—Ä–∏–ø—è—â–∏–π, —Å–ª–∏—à–∫–æ–º –≥—Ä–æ–º–∫–∏–π –∑–≤—É–∫ –≤–µ—Ä–µ—Ç–µ–Ω–∞, —Ç–æ—Ä–æ–ø–ª–∏–≤–æ –∏–¥–µ—Ç, —Å–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–ª–∏ –ø—É—Å–∫–∞–µ—Ç –µ–≥–æ –≤ –Ω–∞–¥–ª–µ–∂–∞—â–∏–π —Ö–æ–¥, ‚Äî —Ç–∞–∫ –∏ –ê–Ω–Ω–∞ –ü–∞–≤–ª–æ–≤–Ω–∞, –ø—Ä–æ—Ö–∞–∂–∏–≤–∞—è—Å—å –ø–æ —Å–≤–æ–µ–π –≥–æ—Å—Ç–∏–Ω–æ–π, –ø–æ–¥—Ö–æ–¥–∏–ª–∞ –∫ –∑–∞–º–æ–ª–∫–Ω—É–≤—à–µ–º—É –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥–æ–≤–æ—Ä–∏–≤—à–µ–º—É –∫—Ä—É–∂–∫—É –∏ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –æ–ø—è—Ç—å –∑–∞–≤–æ–¥–∏–ª–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—É—é, –ø—Ä–∏–ª–∏—á–Ω—É—é —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—É—é –º–∞—à–∏–Ω—É. –ù–æ —Å—Ä–µ–¥–∏ —ç—Ç–∏—Ö –∑–∞–±–æ—Ç –≤—Å–µ –≤–∏–¥–µ–Ω –±—ã–ª –≤ –Ω–µ–π –æ—Å–æ–±–µ–Ω–Ω—ã–π —Å—Ç—Ä–∞—Ö –∑–∞ –ü—å–µ—Ä–∞. –û–Ω–∞ –∑–∞–±–æ—Ç–ª–∏–≤–æ –ø–æ–≥–ª—è–¥—ã–≤–∞–ª–∞ –Ω–∞ –Ω–µ–≥–æ –≤ —Ç–æ –≤—Ä–µ–º—è, –∫–∞–∫ –æ–Ω –ø–æ–¥–æ—à–µ–ª –ø–æ—Å–ª—É—à–∞—Ç—å —Ç–æ, —á—Ç–æ –≥–æ–≤–æ—Ä–∏–ª–æ—Å—å –æ–∫–æ–ª–æ –ú–æ—Ä—Ç–µ–º–∞—Ä–∞, –∏ –æ—Ç–æ—à–µ–ª –∫ –¥—Ä—É–≥–æ–º—É –∫—Ä—É–∂–∫—É, –≥–¥–µ –≥–æ–≤–æ—Ä–∏–ª –∞–±–±–∞—Ç. –î–ª—è –ü—å–µ—Ä–∞, –≤–æ—Å–ø–∏—Ç–∞–Ω–Ω–æ–≥–æ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π, —ç—Ç–æ—Ç –≤–µ—á–µ—Ä –ê–Ω–Ω—ã –ü–∞–≤–ª–æ–≤–Ω—ã –±—ã–ª –ø–µ—Ä–≤—ã–π, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –≤–∏–¥–µ–ª –≤ –†–æ—Å—Å–∏–∏. –û–Ω –∑–Ω–∞–ª, —á—Ç–æ —Ç—É—Ç —Å–æ–±—Ä–∞–Ω–∞ –≤—Å—è –∏–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ü–∏—è –ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, –∏ —É –Ω–µ–≥–æ, –∫–∞–∫ —É —Ä–µ–±–µ–Ω–∫–∞ –≤ –∏–≥—Ä—É—à–µ—á–Ω–æ–π –ª–∞–≤–∫–µ, —Ä–∞–∑–±–µ–≥–∞–ª–∏—Å—å –≥–ª–∞–∑–∞. –û–Ω –≤—Å–µ –±–æ—è–ª—Å—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–º–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –º–æ–∂–µ—Ç —É—Å–ª—ã—Ö–∞—Ç—å. –ì–ª—è–¥—è –Ω–∞ —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏ –∏–∑—è—â–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ª–∏—Ü, —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–¥–µ—Å—å, –æ–Ω –≤—Å–µ –∂–¥–∞–ª —á–µ–≥–æ-–Ω–∏–±—É–¥—å –æ—Å–æ–±–µ–Ω–Ω–æ —É–º–Ω–æ–≥–æ. –ù–∞–∫–æ–Ω–µ—Ü –æ–Ω –ø–æ–¥–æ—à–µ–ª –∫ –ú–æ—Ä–∏–æ. –†–∞–∑–≥–æ–≤–æ—Ä –ø–æ–∫–∞–∑–∞–ª—Å—è –µ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–µ–Ω, –∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –æ–∂–∏–¥–∞—è —Å–ª—É—á–∞—è –≤—ã—Å–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏, –∫–∞–∫ —ç—Ç–æ –ª—é–±—è—Ç –º–æ–ª–æ–¥—ã–µ –ª—é–¥–∏.¬ª
        """,
        "description": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —ç–ø–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–∞—Ö"
    },
    "pelevin": {
        "name": "–í.–û. –ü–µ–ª–µ–≤–∏–Ω", 
        "fragment": """
–§—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ "Generation –ü":
¬´–æ –∫–æ—Ä–∏–¥–æ—Ä—É –±–µ–∂–∏—Ç –º–∞–ª–µ–Ω—å–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞.  –ù–∞—Ä–∏—Å–æ–≤–∞–Ω–∞  –æ–Ω–∞  —Å  –±–æ–ª—å—à–æ–π  –ª—é–±–æ–≤—å—é,
–¥–∞–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ  —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ.  –ï—Å–ª–∏  –Ω–∞–∂–∞—Ç—å  –∫–ª–∞–≤–∏—à—É  "Up",  –æ–Ω–∞  –ø–æ–¥–ø—Ä—ã–≥–Ω–µ—Ç
–≤–≤–µ—Ä—Ö, –ø—Ä–æ–≥–Ω–µ—Ç—Å—è, –ø–æ–≤–∏—Å–Ω–µ—Ç –Ω–∞ —Å–µ–∫—É–Ω–¥—É –≤ –≤–æ–∑–¥—É—Ö–µ –∏  –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è  —á—Ç–æ-—Ç–æ  –ø–æ–π–º–∞—Ç—å
–Ω–∞–¥ —Å–≤–æ–µ–π –≥–æ–ª–æ–≤–æ–π. –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç—å  "Down",  –æ–Ω–∞  –ø—Ä–∏—Å—è–¥–µ—Ç  –∏  –ø–æ—Å—Ç–∞—Ä–∞–µ—Ç—Å—è  —á—Ç–æ-—Ç–æ
–ø–æ–¥–Ω—è—Ç—å —Å –∑–µ–º–ª–∏ –ø–æ–¥ –Ω–æ–≥–∞–º–∏. –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç—å  "Right",  –æ–Ω–∞  –ø–æ–±–µ–∂–∏—Ç  –≤–ø—Ä–∞–≤–æ.  –ï—Å–ª–∏
–Ω–∞–∂–∞—Ç—å "Left" - –≤–ª–µ–≤–æ. –í–æ–æ–±—â–µ, –µ—é –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞–≤–∏—à,  –Ω–æ
—ç—Ç–∏ —á–µ—Ç—ã—Ä–µ - –æ—Å–Ω–æ–≤–Ω—ã–µ.
   –ü—Ä–æ—Ö–æ–¥, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±–µ–∂–∏—Ç —Ñ–∏–≥—É—Ä–∫–∞,  –º–µ–Ω—è–µ—Ç—Å—è.  –ë–æ–ª—å—à–µ–π  —á–∞—Å—Ç—å—é  —ç—Ç–æ  —á—Ç–æ-—Ç–æ
–≤—Ä–æ–¥–µ –∫–∞–º–µ–Ω–Ω–æ–π —à—Ç–æ–ª—å–Ω–∏, –Ω–æ –∏–Ω–æ–≥–¥–∞ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫—Ä–∞—Å–æ—Ç—ã  –≥–∞–ª–µ—Ä–µ–µ–π
—Å –ø–æ–ª–æ—Å–æ–π –≤–æ—Å—Ç–æ—á–Ω–æ–≥–æ –æ—Ä–Ω–∞–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç–µ–Ω–µ –∏ –≤—ã—Å–æ–∫–∏–º–∏ —É–∑–∫–∏–º–∏  –æ–∫–Ω–∞–º–∏.  –ù–∞  —Å—Ç–µ–Ω–∞—Ö
–≥–æ—Ä—è—Ç —Ñ–∞–∫–µ–ª—ã, –∞  –≤  —Ç—É–ø–∏–∫–∞—Ö  –∫–æ—Ä–∏–¥–æ—Ä–æ–≤  –∏  –Ω–∞  —à–∞—Ç–∫–∏—Ö  –º–æ—Å—Ç–∫–∞—Ö  –Ω–∞–¥  –≥–ª—É–±–æ–∫–∏–º–∏
–∫–∞–º–µ–Ω–Ω—ã–º–∏ —à–∞—Ö—Ç–∞–º–∏ —Å—Ç–æ—è—Ç –≤—Ä–∞–≥–∏ —Å –æ–±–Ω–∞–∂–µ–Ω–Ω—ã–º–∏ –º–µ—á–∞–º–∏  -  —Å  –Ω–∏–º–∏  —Ñ–∏–≥—É—Ä–∫–∞  –º–æ–∂–µ—Ç
—Å—Ä–∞–∂–∞—Ç—å—Å—è, –µ—Å–ª–∏ –Ω–∞–∂–∏–º–∞—Ç—å –∫–ª–∞–≤–∏—à—É  "Shift".  –ï—Å–ª–∏  –Ω–∞–∂–∏–º–∞—Ç—å  –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ  –∫–ª–∞–≤–∏—à–∏
–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏, —Ñ–∏–≥—É—Ä–∫–∞ –º–æ–∂–µ—Ç –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞—Ç—å  –∏  –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è,  –≤–∏—Å–µ—Ç—å,
–∫–∞—á–∞—è—Å—å, –Ω–∞ –∫—Ä–∞—é, –∏ –¥–∞–∂–µ –º–æ–∂–µ—Ç —Å —Ä–∞–∑–±–µ–≥–∞ –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—Ç—å  –∫–∞–º–µ–Ω–Ω—ã–µ  –∫–æ–ª–æ–¥—Ü—ã,  –∏–∑
–¥–Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö  —Ç–æ—Ä—á–∞—Ç  –æ—Å—Ç—Ä—ã–µ  —à–∏–ø—ã.  –£  –∏–≥—Ä—ã  –º–Ω–æ–≥–æ  —É—Ä–æ–≤–Ω–µ–π,  —Å  –Ω–∏–∂–Ω–∏—Ö  –º–æ–∂–Ω–æ
–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤–≤–µ—Ä—Ö, –∞ —Å –≤—ã—Å—à–∏—Ö –ø—Ä–æ–≤–∞–ª–∏–≤–∞—Ç—å—Å—è –≤–Ω–∏–∑ - –ø—Ä–∏ —ç—Ç–æ–º –º–µ–Ω—è—é—Ç—Å—è  –∫–æ—Ä–∏–¥–æ—Ä—ã,
–º–µ–Ω—è—é—Ç—Å—è –ª–æ–≤—É—à–∫–∏, –ø–æ –¥—Ä—É–≥–æ–º—É –≤—ã–≥–ª—è–¥—è—Ç –∫—É–≤—à–∏–Ω—ã, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∏–≥—É—Ä–∫–∞ –ø—å–µ—Ç,  —á—Ç–æ–±—ã
–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏–ª—ã, –Ω–æ –≤—Å–µ –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ –ø—Ä–µ–∂–Ω–µ–º—É - —Ñ–∏–≥—É—Ä–∫–∞  –±–µ–∂–∏—Ç
—Å—Ä–µ–¥–∏ –∫–∞–º–µ–Ω–Ω—ã—Ö –ø–ª–∏—Ç, —Ñ–∞–∫–µ–ª–æ–≤, —á–µ—Ä–µ–ø–æ–≤ –Ω–∞ –ø–æ–ª—É –∏ —Ä–∏—Å—É–Ω–∫–æ–≤ –Ω–∞ —Å—Ç–µ–Ω–∞—Ö. –¶–µ–ª—å  –∏–≥—Ä—ã
- –ø–æ–¥–Ω—è—Ç—å—Å—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è, –≥–¥–µ  –∂–¥–µ—Ç  –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞,  –Ω–æ  –¥–ª—è  —ç—Ç–æ–≥–æ  –Ω—É–∂–Ω–æ
–ø–æ—Å–≤—è—Ç–∏—Ç—å –∏–≥—Ä–µ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –≥–æ–≤–æ—Ä—è, —á—Ç–æ–±—ã –¥–æ–±–∏—Ç—å—Å—è  –≤  –∏–≥—Ä–µ
—É—Å–ø–µ—Ö–∞, –Ω–∞–¥–æ –∑–∞–±—ã—Ç—å, —á—Ç–æ –Ω–∞–∂–∏–º–∞–µ—à—å –Ω–∞ –∫–Ω–æ–ø–∫–∏, –∏ —Å—Ç–∞—Ç—å —ç—Ç–æ–π —Ñ–∏–≥—É—Ä–∫–æ–π  —Å–∞–º–æ–º—É  -
—Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ —É –Ω–µ–µ –ø–æ—è–≤–∏—Ç—Å—è —Å—Ç–µ–ø–µ–Ω—å –ø—Ä–æ–≤–æ—Ä—Å—Ç–≤–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è, —á—Ç–æ–±—ã  —Ñ–µ—Ö—Ç–æ–≤–∞—Ç—å,
–ø—Ä–æ—Å–∫–∞–∫–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ —â–µ–ª–∫–∞—é—â–∏–µ –≤ —É–∑–∫–∏—Ö –∫–∞–º–µ–Ω–Ω—ã—Ö  –∫–æ—Ä–∏–¥–æ—Ä–∞—Ö  —Ä–∞–∑—Ä–µ–∑–∞–ª–∫–∏  –ø–æ–ø–æ–ª–∞–º,
–ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—Ç—å –¥—ã—Ä—ã –≤ –ø–æ–ª—É –∏ –±–µ–∂–∞—Ç—å  –ø–æ  —Å—Ä—ã–≤–∞—é—â–∏–º—Å—è  –≤–Ω–∏–∑  –ø–ª–∏—Ç–∞–º,  –∫–∞–∂–¥–∞—è  –∏–∑
–∫–æ—Ç–æ—Ä—ã—Ö —Å–ø–æ—Å–æ–±–Ω–∞ –≤—ã–¥–µ—Ä–∂–∞—Ç—å –≤–µ—Å —Ç–µ–ª–∞ —Ç–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥—É, —Ö–æ—Ç—è –Ω–∏–∫–∞–∫–æ–≥–æ —Ç–µ–ª–∞  –∏  —Ç–µ–º
–±–æ–ª–µ–µ –≤–µ—Å–∞ —É —Ñ–∏–≥—É—Ä–∫–∏ –Ω–µ—Ç, –∫–∞–∫ –Ω–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ –≤–¥—É–º–∞—Ç—å—Å—è, –∏ —É  —Å—Ä—ã–≤–∞—é—â–∏—Ö—Å—è  –ø–ª–∏—Ç,
–∫–∞–∫ –±—ã —É–±–µ–¥–∏—Ç–µ–ª–µ–Ω –Ω–∏ –∫–∞–∑–∞–ª—Å—è –∏–∑–¥–∞–≤–∞–µ–º—ã–π –∏–º–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å—Ç—É–∫.
   –ü—Ä–∏–Ω—Ü –±–µ–∂–∞–ª –ø–æ –∫–∞–º–µ–Ω–Ω–æ–º—É –∫–∞—Ä–Ω–∏–∑—É; –Ω–∞–¥–æ –±—ã–ª–æ —É—Å–ø–µ—Ç—å  –ø–æ–¥–ª–µ–∑—Ç—å  –ø–æ–¥  –∂–µ–ª–µ–∑–Ω—É—é
—Ä–µ—à–µ—Ç–∫—É –¥–æ —Ç–æ–≥–æ, –∫–∞–∫  –æ–Ω–∞  –æ–ø—É—Å—Ç–∏—Ç—Å—è,  –ø–æ—Ç–æ–º—É  —á—Ç–æ  –∑–∞  –Ω–µ–π  —Å—Ç–æ—è–ª  —É–∑–∫–æ–≥–æ—Ä–ª—ã–π
–∫—É–≤—à–∏–Ω, –∞ —Å–∏–ª –ø–æ—á—Ç–∏ –Ω–µ –±—ã–ª–æ: —Å–∑–∞–¥–∏ –æ—Å—Ç–∞–ª–∏—Å—å –¥–≤–∞ –∫–æ–ª–æ–¥—Ü–∞ —Å —à–∏–ø–∞–º–∏, –¥–∞ –∏  –ø—Ä—ã–∂–æ–∫
—Å–æ –≤—Ç–æ—Ä–æ–≥–æ —è—Ä—É—Å–∞ –Ω–∞ —É—Å–µ—è–Ω–Ω—ã–π –∫–∞–º–µ–Ω–Ω—ã–º–∏ –æ–±–ª–æ–º–∫–∞–º–∏ –ø–æ–ª —Ç–æ–∂–µ —Å—Ç–æ–∏–ª  –Ω–µ–º–∞–ª–æ.  –°–∞—à–∞
–Ω–∞–∂–∞–ª "Right" –∏ —Å—Ä–∞–∑—É –∂–µ –∑–∞ –Ω–µ–π "Down", –∏  –ø—Ä–∏–Ω—Ü  –∫–∞–∫–∏–º-—Ç–æ  —á—É–¥–æ–º  –ø—Ä–æ–ª–µ–∑  –ø–æ–¥
—Ä–µ—à–µ—Ç–∫–æ–π, —Å–ø—É—Å—Ç–∏–≤—à—É—é—Å—è —É–∂–µ –ø–æ—á—Ç–∏ –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É. –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–º–µ–Ω–∏–ª–∞—Å—å,  –Ω–æ
–≤–º–µ—Å—Ç–æ  –∫—É–≤—à–∏–Ω–∞  –Ω–∞  –º–æ—Å—Ç–∏–∫–µ  –≤–ø–µ—Ä–µ–¥–∏  —Å—Ç–æ—è–ª   –∂–∏—Ä–Ω—ã–π   –≤–æ–∏–Ω   –≤   —Ç—é—Ä–±–∞–Ω–µ   –∏
–≥–∏–ø–Ω–æ—Ç–∏–∑–∏—Ä—É—é—â–µ –≥–ª—è–¥–µ–ª –Ω–∞ –°–∞—à—É.
   -  –õ–∞–ø–∏–Ω!  -  —Ä–∞–∑–¥–∞–ª—Å—è  —Å–∑–∞–¥–∏  –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ  –∑–Ω–∞–∫–æ–º—ã–π  –≥–æ–ª–æ—Å,  –∏  —É   –°–∞—à–∏
–ø–µ—Ä–µ—Ö–≤–∞—Ç–∏–ª–æ –ø–æ–¥ –ª–æ–∂–µ—á–∫–æ–π, —Ö–æ—Ç—è —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ  –Ω–∏–∫–∞–∫–æ–≥–æ  –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–≥–æ  –ø–æ–≤–æ–¥–∞  –¥–ª—è
—Å—Ç—Ä–∞—Ö–∞ –Ω–µ –±—ã–ª–æ.
   - –î–∞, –ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á?
   - –ê –∑–∞–π–¥–∏-–∫–∞ –∫–æ –º–Ω–µ.
   –ö–∞–±–∏–Ω–µ—Ç –ë–æ—Ä–∏—Å–∞ –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á–∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–∏–∫–∞–∫–∏–º –∫–∞–±–∏–Ω–µ—Ç–æ–º –Ω–µ –±—ã–ª,  –∞  –±—ã–ª
–ø—Ä–æ—Å—Ç–æ —á–∞—Å—Ç—å—é –∫–æ–º–Ω–∞—Ç—ã, –æ—Ç–≥–æ—Ä–æ–∂–µ–Ω–Ω–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –Ω–µ–≤—ã—Å–æ–∫–∏–º–∏  —à–∫–∞—Ñ–∞–º–∏,  –∏  –∫–æ–≥–¥–∞
–ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á —Ö–æ–¥–∏–ª –ø–æ  —Å–≤–æ–µ–π  —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏,  –Ω–∞–¥  –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é  —à–∫–∞—Ñ–æ–≤  –±—ã–ª
–≤–∏–¥–µ–Ω –µ–≥–æ –ª—ã—Å—ã–π  –∑–∞—Ç—ã–ª–æ–∫,  –æ—Ç—á–µ–≥–æ  –°–∞—à–µ  –∏–Ω–æ–≥–¥–∞  –∫–∞–∑–∞–ª–æ—Å—å,  —á—Ç–æ  –æ–Ω  —Å–∏–¥–∏—Ç  –Ω–∞
–∫–æ—Ä—Ç–æ—á–∫–∞—Ö –≤–æ–∑–ª–µ –±–∏–ª—å—è—Ä–¥–∞ –∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç –∑–∞  –¥–≤–∏–∂–µ–Ω–∏–µ–º  –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ  –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è
—à–∞—Ä–∞, —á–∞—Å—Ç–∏—á–Ω–æ —Å–∫—Ä—ã—Ç–æ–≥–æ –±–æ—Ä—Ç–æ–º. –ü–æ—Å–ª–µ –æ–±–µ–¥–∞ –ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á  –æ–±—ã—á–Ω–æ  –ø–æ–ø–∞–¥–∞–ª
–≤ –ª—É–∑—É, –∞ —Å —É—Ç—Ä–∞, –≤  –∑–æ–ª–æ—Ç–æ–µ  –≤—Ä–µ–º—è,  –±–æ–ª—å—à–µ–π  —á–∞—Å—Ç—å—é  –æ—Ç—Å–∫–∞–∫–∏–≤–∞–ª  –æ—Ç  –±–æ—Ä—Ç–æ–≤,
–ø—Ä–∏—á–µ–º —Ä–æ–ª—å –∫–∏—è –∏–≥—Ä–∞–ª —Ç–µ–ª–µ—Ñ–æ–Ω,  –∑–≤–æ–Ω–∫–∏  –∫–æ—Ç–æ—Ä–æ–≥–æ  –∑–∞—Å—Ç–∞–≤–ª—è–ª–∏  –ø–æ–ª—É—Å—Ñ–µ—Ä—É  —Ü–≤–µ—Ç–∞
—Å–ª–æ–Ω–æ–≤–æ–π –∫–æ—Å—Ç–∏ –Ω–∞–¥ –∑–∞–≤–∞–ª–µ–Ω–Ω–æ–π –±—É–º–∞–≥–∞–º–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é —à–∫–∞—Ñ–∞ –¥–≤–∏–≥–∞—Ç—å—Å—è  –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ
–≤—Ä–µ–º—è –±—ã—Å—Ç—Ä–µ–µ.
   –°–∞—à–∞ –Ω–µ–Ω–∞–≤–∏–¥–µ–ª  –ë–æ—Ä–∏—Å–∞  –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á–∞  —Ç–æ–π  –æ—Å–æ–±–æ–π  –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π  –∏  —Å–ø–æ–∫–æ–π–Ω–æ–π
–Ω–µ–Ω–∞–≤–∏—Å—Ç—å—é, –∫–æ—Ç–æ—Ä–∞—è –∑–Ω–∞–∫–æ–º–∞ —Ç–æ–ª—å–∫–æ –∂–∏–≤—É—â–∏–º —É –∂–µ—Å—Ç–æ–∫–æ–≥–æ —Ö–æ–∑—è–∏–Ω–∞ —Å–∏–∞–º—Å–∫–∏–º  –∫–æ—Ç–∞–º
–∏  —á–∏—Ç–∞–≤—à–∏–º  –û—Ä—É—ç–ª–ª–∞  —Å–æ–≤–µ—Ç—Å–∫–∏–º  –∏–Ω–∂–µ–Ω–µ—Ä–∞–º.  –°–∞—à–∞  –≤—Å–µ–≥–æ  –û—Ä—É—ç–ª–ª–∞   –ø—Ä–æ—á–µ–ª   –≤
–∏–Ω—Å—Ç–∏—Ç—É—Ç–µ, –µ—â–µ –∫–æ–≥–¥–∞ –±—ã–ª–æ –Ω–µ–ª—å–∑—è,  –∏  —Å  —Ç–µ—Ö  –ø–æ—Ä  –∫–∞–∂–¥—ã–π  –¥–µ–Ω—å  –Ω–∞—Ö–æ–¥–∏–ª  —É–π–º—É
–ø–æ–≤–æ–¥–æ–≤, —á—Ç–æ–±—ã —Å –∫—Ä–∏–≤–æ–π —É–ª—ã–±–∫–æ–π –ø–æ–∫–∞—á–∞—Ç—å –≥–æ–ª–æ–≤–æ–π.  –í–æ—Ç  –∏  —Å–µ–π—á–∞—Å,  –ø–æ–¥—Ö–æ–¥—è  –∫
–ø—Ä–æ—Ö–æ–¥—É –º–µ–∂–¥—É –¥–≤—É—Ö —à–∫–∞—Ñ–æ–≤, –æ–Ω –∫—Ä–∏–≤–æ —É–ª—ã–±–Ω—É–ª—Å—è –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º—É —Ä–∞–∑–≥–æ–≤–æ—Ä—É.
   –ë–æ—Ä–∏—Å  –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á  —Å—Ç–æ—è–ª  —É  –æ–∫–Ω–∞  –∏,  –ø–æ–¥–æ–ª–≥—É   –∑–∞–º–∏—Ä–∞—è   –≤   –∫–∞–∂–¥–æ–º   –∏–∑
–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö  –ø–æ–ª–æ–∂–µ–Ω–∏–π,  –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–ª  —É–¥–∞—Ä  "–ø–æ–ª–µ—Ç  –ª–∞—Å—Ç–æ—á–∫–∏",   –ø—Ä–∏—á–µ–º   –Ω–µ
–±–∞–º–±—É–∫–æ–≤–æ–π –ø–∞–ª–∫–æ–π, –∫–∞–∫ —Å–æ–≤—Å–µ–º  –Ω–µ–¥–∞–≤–Ω–æ,  –∫–æ–≥–¥–∞  –æ–Ω  —Ç–æ–ª—å–∫–æ  –Ω–∞—á–∏–Ω–∞–ª  –æ—Å–≤–∞–∏–≤–∞—Ç—å
"–ë—É–¥–æ–∫–∞–Ω", –∞ –Ω–∞—Å—Ç–æ—è—â–∏–º —Å–∞–º—É—Ä–∞–π—Å–∫–∏–º  –º–µ—á–æ–º.  –°–µ–≥–æ–¥–Ω—è  –Ω–∞  –Ω–µ–º  –±—ã–ª–∞  "–æ—Ö–æ—Ç–Ω–∏—á—å—è
–æ–¥–µ–∂–¥–∞" –∏–∑ –∑–µ–ª–µ–Ω–æ–≥–æ –∞—Ç–ª–∞—Å–∞, –ø–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –≤–∏–¥–Ω–µ–ª–æ—Å—å –º—è—Ç–æ–µ  –∫–∏–º–æ–Ω–æ  –∏–∑  —É–∑–æ—Ä—á–∞—Ç–æ–π
—Ç–∫–∞–Ω–∏ —Å–∏–Ω–æ–±—É. –ö–æ–≥–¥–∞ –°–∞—à–∞ –≤–æ—à–µ–ª, –æ–Ω –±–µ—Ä–µ–∂–Ω–æ –ø–æ–ª–æ–∂–∏–ª –º–µ—á –Ω–∞ –ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫,  —Å–µ–ª  –Ω–∞
—Ü–∏–Ω–æ–≤–∫—É –∏ —É–∫–∞–∑–∞–ª –Ω–∞ —Å–æ—Å–µ–¥–Ω—é—é. –°–∞—à–∞, —Å —Ç—Ä—É–¥–æ–º –ø–æ–¥–≤–µ—Ä–Ω—É–≤ –ø–æ–¥ —Å–µ–±—è  –Ω–æ–≥–∏,  —Å–µ–ª  –∏
–ø–æ–º–µ—Å—Ç–∏–ª —Å–≤–æ–π –≤–∑–≥–ª—è–¥  –Ω–∞  –ø–ª–∞–∫–∞—Ç  —Ñ–∏—Ä–º—ã  "–•–æ–Ω–¥–∞"  —Å  –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–º  –≤  –≤—ã—Å–æ–∫–∏—Ö
–∫–æ–∂–∞–Ω—ã—Ö —Å–∞–ø–æ–≥–∞—Ö, –≤—Ç–æ—Ä–æ–π –≥–æ–¥ –¥–µ–ª–∞—é—â–∏–º –≤–∏—Ä–∞–∂ –Ω–∞ —Å—Ç–µ–Ω–∫–µ —à–∫–∞—Ñ–∞ —Å–ø—Ä–∞–≤–∞  –æ—Ç  —Ü–∏–Ω–æ–≤–∫–∏
–ë–æ—Ä–∏—Å–∞ –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á–∞. –ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á –ø–æ–ª–æ–∂–∏–ª  –ª–∞–¥–æ–Ω—å  –Ω–∞  –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã–π  –±–ª–æ–∫
—Å–≤–æ–µ–π "—ç–π—Ç–∏—à–∫–∏" - —Ç–∞–∫–æ–π  –∂–µ,  –∫–∞–∫  —É  –°–∞—à–∏,  —Ç–æ–ª—å–∫–æ  —Å  –≤–∏–Ω—Ç–æ–º  –≤  –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç
–º–µ–≥–∞–±–∞–π—Ç, - –∏ –∑–∞–∫—Ä—ã–ª –≥–ª–∞–∑–∞, —Ä–∞–∑–º—ã—à–ª—è—è, –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –±–µ—Å–µ–¥—É.
   - –ß–∏—Ç–∞–ª –ø–æ—Å–ª–µ–¥–Ω–∏–µ "–ê—Ä–≥—É–º–µ–Ω—Ç—ã"? - —Å–ø—Ä–æ—Å–∏–ª –æ–Ω —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.
   - –ù–µ—Ç, - –æ—Ç–≤–µ—Ç–∏–ª –°–∞—à–∞, - —è –Ω–µ –≤—ã–ø–∏—Å—ã–≤–∞—é.
   - –ó—Ä—è, - —Å–∫–∞–∑–∞–ª –ë–æ—Ä–∏—Å  –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á,  –ø–æ–¥–Ω–∏–º–∞—è  —Å  –ø–æ–ª–∞  —Å–≤–µ—Ä–Ω—É—Ç—ã–µ  –ª–∏—Å—Ç—ã  –∏
–ø–æ—Ç—Ä—è—Ö–∏–≤–∞—è –∏–º–∏ –≤ –≤–æ–∑–¥—É—Ö–µ, - –æ—Ç–ª–∏—á–Ω–∞—è –≥–∞–∑–µ—Ç–∞.  –Ø  –Ω–µ  –ø–æ–Ω–∏–º–∞—é,  –Ω–∞  —á—Ç–æ  —Ç–æ–ª—å–∫–æ
–∫–æ–º–º—É–Ω–∏—Å—Ç—ã –Ω–∞–¥–µ—é—Ç—Å—è?  –ü—è—Ç—å–¥–µ—Å—è—Ç  –º–∏–ª–ª–∏–æ–Ω–æ–≤  —á–µ–ª–æ–≤–µ–∫  –∑–∞–≥—É–±–∏–ª–∏,  –∏  —Å–µ–π—á–∞—Å  –µ—â–µ
—á—Ç–æ-—Ç–æ –±–æ—Ä–º–æ—á—É—Ç. –í—Å–µ –∂–µ –≤—Å–µ–º —è—Å–Ω–æ.
   - –ê–≥–∞, - —Å–∫–∞–∑–∞–ª –°–∞—à–∞.
   - –ò–ª–∏ –≤–æ—Ç, - —Å–∫–∞–∑–∞–ª –ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á, -  –≤  –ê–º–µ—Ä–∏–∫–µ  –æ–∫–æ–ª–æ  —Ç—ã—Å—è—á–∏  –∂–µ–Ω—â–∏–Ω
–±–µ—Ä–µ–º–µ–Ω–Ω—ã –æ—Ç –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω. –£ –Ω–∞—Å —Ç–æ–∂–µ —Ç–∞–∫–∏—Ö –ø–æ–ª–Ω–æ, –Ω–æ –∏—Ö –ö–ì–ë –≥–¥–µ-—Ç–æ –ø—Ä—è—á–µ—Ç.
   "–ß–µ–≥–æ –æ–Ω —Ö–æ—á–µ—Ç-—Ç–æ?" - —Å —Ç–æ—Å–∫–æ–π –ø–æ–¥—É–º–∞–ª –°–∞—à–∞.
   –ë–æ—Ä–∏—Å –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏—á –∑–∞–¥—É–º–∞–ª—Å—è.
   - –°—Ç—Ä–∞–Ω–Ω—ã–π —Ç—ã –ø–∞—Ä–µ–Ω—å, –°–∞–Ω—è, - –Ω–∞–∫–æ–Ω–µ—Ü, —Å–∫–∞–∑–∞–ª –æ–Ω. - –ì–ª—è–¥–∏—à—å –±–∏—Ä—é–∫–æ–º,  –Ω–∏  —Å
–∫–µ–º –∏–∑ –æ—Ç–¥–µ–ª–∞ –Ω–µ –¥—Ä—É–∂–∏—à—å. –í–µ–¥—å —Ç—ã –∑–Ω–∞–µ—à—å, –ª—é–¥–∏ –≤–æ–∫—Ä—É–≥, –Ω–µ –º–µ–±–µ–ª—å. –ê  —Ç—ã  –≤—á–µ—Ä–∞
–õ—é—Å—é –Ω–∞–ø—É–≥–∞–ª –¥–∞–∂–µ.  –û–Ω–∞  —Å–µ–≥–æ–¥–Ω—è  –º–Ω–µ  –≥–æ–≤–æ—Ä–∏—Ç:"–ó–Ω–∞–µ—Ç–µ,  –ë–æ—Ä–∏—Å  –ì—Ä–∏–≥–æ—Ä–∏—á,  –∫–∞–∫
—Ö–æ—Ç–∏—Ç–µ, –∞ –º–Ω–µ —Å –Ω–∏–º –≤ –ª–∏—Ñ—Ç–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞—à–Ω–æ –µ–∑–¥–∏—Ç—å."
   - –Ø —Å –Ω–µ–π –≤ –ª–∏—Ñ—Ç–µ –Ω–∏ —Ä–∞–∑—É –Ω–µ –µ–∑–¥–∏–ª, - —Å–∫–∞–∑–∞–ª –°–∞—à–∞.
   - –¢–∞–∫ –ø–æ—ç—Ç–æ–º—É –∏ –±–æ–∏—Ç—Å—è, - —Å–∫–∞–∑–∞–ª –ë–æ—Ä–∏—Å  –ì—Ä–∏–≥–æ—Ä—å–µ–≤–∏–ß¬ª
        """,
        "description": "–ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º, –∏—Ä–æ–Ω–∏—è, —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è, –∏–≥—Ä–∞ —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é"
    },
    "nabokov": {
        "name": "–í.–í. –ù–∞–±–æ–∫–æ–≤",
        "fragment": """
–§—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ "–õ–æ–ª–∏—Ç—ã":
¬´–õ–æ–ª–∏—Ç–∞, —Å–≤–µ—Ç –º–æ–µ–π –∂–∏–∑–Ω–∏, –æ–≥–æ–Ω—å –º–æ–∏—Ö —á—Ä–µ—Å–µ–ª. –ì—Ä–µ—Ö –º–æ–π, –¥—É—à–∞ –º–æ—è. –õ–æ-–ª–∏-—Ç–∞: –∫–æ–Ω—á–∏–∫ —è–∑—ã–∫–∞ —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø—É—Ç—å –≤ —Ç—Ä–∏ —à–∞–∂–∫–∞ –≤–Ω–∏–∑ –ø–æ –Ω—ë–±—É, —á—Ç–æ–±—ã –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —Ç–æ–ª–∫–Ω—É—Ç—å—Å—è –æ –∑—É–±—ã. –õ–æ. –õ–∏. –¢–∞. 
–û–Ω–∞ –±—ã–ª–∞ –õ–æ —É—Ç—Ä–æ–º, —Å—Ç–æ—è –≤–æ –≤–µ—Å—å —Å–≤–æ–π —Ä–æ—Å—Ç –≤ —á–µ—Ç—ã—Ä–µ —Ñ—É—Ç–∞ –¥–µ—Å—è—Ç—å –¥—é–π–º–æ–≤, –≤ –æ–¥–Ω–æ–º –Ω–æ—Å–∫–µ. –û–Ω–∞ –±—ã–ª–∞ –õ–æ–ª–∞ –≤ —à—Ç–∞–Ω–∞—Ö. –û–Ω–∞ –±—ã–ª–∞ –î–æ–ª–ª–∏ –≤ —à–∫–æ–ª–µ. –û–Ω–∞ –±—ã–ª–∞ –î–æ–ª–æ—Ä–µ—Å –Ω–∞ –ø—É–Ω–∫—Ç–∏—Ä–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. 
–ù–æ –≤ –º–æ–∏—Ö –æ–±—ä—è—Ç–∏—è—Ö –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∞ –õ–æ–ª–∏—Ç–æ–π. –†–∞–∑–≤–µ –Ω–µ —Å–ª—É—á–∞–ª–æ—Å—å —Ç–µ–±–µ, –≤ –ª–µ—Ç–Ω–∏–π —á–∞—Å, —É—Å–ª—ã—à–∞—Ç—å –≥–¥–µ-—Ç–æ –≤–¥–∞–ª–∏ –≥—É–ª –Ω–µ–≤–∏–¥–∏–º–æ–π –º–∞—à–∏–Ω—ã –∏, –ø—Ä–∏—Å–ª—É—à–∞–≤—à–∏—Å—å, –ø–æ–Ω—è—Ç—å, 
—á—Ç–æ —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –∫—Ä–æ–≤—å, –≥—É–¥–µ–≤—à–∞—è –≤ —Ç–≤–æ–∏—Ö —É—à–∞—Ö? –†–∞–∑–≤–µ –Ω–µ —Å–ª—É—á–∞–ª–æ—Å—å —Ç–µ–±–µ –∫–∞—Å–∞—Ç—å—Å—è —á–µ–≥–æ-–ª–∏–±–æ ‚Äî —Å–∫–∞–∂–µ–º, –ø–æ–¥—É—à–∫–∏ ‚Äî –∏ –æ—â—É—â–∞—Ç—å, –±—É–¥—Ç–æ —Ç–≤–æ—è —Ä—É–∫–∞ —Å–ø–∏—Ç?¬ª
        """,
        "description": "–õ–∏—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∑–∞, –≤–∏—Ä—Ç—É–æ–∑–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ —è–∑—ã–∫–æ–º, —Å–ª–æ–∂–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–æ–Ω–∫–æ—Å—Ç—å"
    }
}

# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∞—Å—Å–∫–∞–∑–∞
STRUCTURE_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç. –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–∞—Å—Å–∫–∞–∑–∞.

## –ó–∞–¥–∞—á–∞:
–°–æ–∑–¥–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–∞—Å—Å–∫–∞–∑–∞ –≤ –∂–∞–Ω—Ä–µ {genre} —Å —Å–µ—Ç—Ç–∏–Ω–≥–æ–º: {setting}
{alias_text}
{style_instruction}

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—é–∂–µ—Ç–∞** (–ø–æ –∫–∞–Ω–æ–Ω–∞–º "–∑–∞–≤—è–∑–∫–∞-–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è-—Ä–∞–∑–≤—è–∑–∫–∞ –∏ —Ñ–∏–Ω–∞–ª"):
   - –ß–∞—Å—Ç—å 1: –ó–∞–≤—è–∑–∫–∞ - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–∏—Ä–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
   - –ß–∞—Å—Ç—å 2: –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è - —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
   - –ß–∞—Å—Ç—å 3: –†–∞–∑–≤—è–∑–∫–∞ –∏ —Ñ–∏–Ω–∞–ª - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π, –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å

2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —á–∞—Å—Ç–µ–π** (3 —á–∞—Å—Ç–∏, –æ–±—ä–µ–º –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –Ω–µ –º–µ–Ω–µ–µ 8000 —Å–ª–æ–≤):
   –î–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —É–∫–∞–∂–∏:
   - –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏
   - –î–µ–π—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Ü–∞
   - –°–∏–Ω–æ–ø—Å–∏—Å: –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
   - –õ–æ–∫–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
   - –£—á–∞—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
   - –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –≤ —Å–ª–æ–≤–∞—Ö

3. **–ü–µ—Ä—Å–æ–Ω–∞–∂–∏** (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ):
   - –ò–º—è –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –•–∞—Ä–∞–∫—Ç–µ—Ä, –º–æ—Ç–∏–≤–∞—Ü–∏—è
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç
   - –†–æ–ª—å –∏ –¥–≤–∏–∂—É—â–∞—è —Å–∏–ª–∞ –≤ —Å—é–∂–µ—Ç–µ
   - –ö–∞–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—É—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —Å—é–∂–µ—Ç–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

4. **–õ–æ–∫–∞—Ü–∏–∏** - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è

5. **–ü—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã** - –∑–Ω–∞—á–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å—é–∂–µ—Ç–µ

6. **–ö—Ä–∞—Ç–∫–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞** - –æ–±—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª–∞

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–π, —á—Ç–æ–±—ã —Å–ª—É–∂–∏—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Ä–∞—Å—Å–∫–∞–∑–∞.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
CHAPTER_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å. –ù–∞–ø–∏—à–∏ —á–∞—Å—Ç—å —Ä–∞—Å—Å–∫–∞–∑–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ü–†–ï–î–´–î–£–©–ò–• –ß–ê–°–¢–ï–ô.
{style_instruction}

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
–ñ–∞–Ω—Ä: {genre}
–°–µ—Ç—Ç–∏–Ω–≥: {setting}
{alias_text}

## –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
{structure}

## –ü–†–ï–î–´–î–£–©–ò–ï –ß–ê–°–¢–ò (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏):
{previous_chapters_context}

## –¢–ï–ö–£–©–ê–Ø –ß–ê–°–¢–¨ {chapter_number} - –î–ï–¢–ê–õ–ò:
{chapter_details}

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –û–±—ä–µ–º: –ø—Ä–∏–º–µ—Ä–Ω–æ {word_count} —Å–ª–æ–≤
- –°—Ç–∏–ª—å: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∂–∞–Ω—Ä—É {genre} –∏ –∞–≤—Ç–æ—Ä—Å–∫–æ–º—É —Å—Ç–∏–ª—é {instruction}, –Ω–æ –±–µ–∑ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∏–ª–∏–∑—É–µ–º–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
- –°—é–∂–µ—Ç: –ù–ï –û–¢–ö–õ–û–ù–Ø–ô–°–Ø –æ—Ç –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –õ–æ–∫–∞—Ü–∏–∏, –ø—Ä–µ–¥–º–µ—Ç—ã: –∏—Å–ø–æ–ª—å–∑—É–π –ª–æ–∫–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è {structure}
- –£–ß–¢–ò –í–°–ï –°–û–ë–´–¢–ò–Ø, –î–ò–ê–õ–û–ì–ò –ò –†–ê–ó–í–ò–¢–ò–ï –ü–ï–†–°–û–ù–ê–ñ–ï–ô –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –ß–ê–°–¢–ï–ô
- –û–ë–ï–°–ü–ï–ß–¨ –ü–õ–ê–í–ù–´–ï –ü–ï–†–ï–•–û–î–´ –ò –õ–û–ì–ò–ß–ï–°–ö–£–Æ –ü–†–ï–ï–ú–°–¢–í–ï–ù–ù–û–°–¢–¨ –° –ü–†–ï–î–´–î–£–©–ò–ú–ò –ß–ê–°–¢–Ø–ú–ò
- –†–∞–∑–≤–∏–≤–∞–π —Å—é–∂–µ—Ç–Ω—ã–µ –ª–∏–Ω–∏–∏, –Ω–∞—á–∞—Ç—ã–µ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç—è—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –†–∞–∑–≤–∏–≤–∞–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –∑–∞–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ
- –ò—Å–ø–æ–ª—å–∑—É–π —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã —Å–æ–≥–ª–∞—Å–Ω–æ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏, —É—á–∏—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –ù–ï –ó–õ–û–£–ü–û–¢–†–ï–ë–õ–Ø–ô –î–ò–ê–õ–û–ì–ê–ú–ò, –ë–û–õ–¨–®–ï –î–ï–ô–°–¢–í–ò–Ø –ò –û–ü–ò–°–ê–ù–ò–ô
- –ú–ï–ù–¨–®–ï –®–¢–ê–ú–ü–û–í –ò –ö–õ–ò–®–ï, –ë–û–õ–¨–®–ï –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–• –ò–î–ï–ô –ò –ù–ï–û–ñ–ò–î–ê–ù–ù–´–• –°–Æ–ñ–ï–¢–ù–´–• –ü–û–í–û–†–û–¢–û–í
- –ù–ï –í–û–°–ü–†–û–ò–ó–í–û–î–ò –í –¢–ï–ö–°–¢–ï –ü–†–û–ú–ü–¢–´ –ò –°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–†–ï–î–´–î–£–©–ò–• –ß–ê–°–¢–ï–ô
- –ò–ó–ë–ï–ì–ê–ô –ù–ï–ù–£–ñ–ù–û–ì–û –ü–ê–§–û–°–ê –í–†–û–î–ï ["–ï–ì–û –ë–û–†–¨–ë–ê –ó–ê –°–ü–†–ê–í–ï–î–õ–ò–í–û–°–¢–¨ –¢–û–õ–¨–ö–û –ù–ê–ß–ò–ù–ê–õ–ê–°–¨", "–≠–¢–û –ë–´–õ–û –ß–¢–û-–¢–û –ù–ï–í–ï–†–û–Ø–¢–ù–û–ï"]
- –ò–ó–ë–ï–ì–ê–ô –ù–ï–†–í–û–ó–ù–´–• –ü–û–í–¢–û–†–Ø–Æ–©–ò–•–°–Ø –§–†–ê–ó –í–†–û–î–ï '–û–ù–ê –°–î–ï–õ–ê–õ–ê –≠–¢–û', '–û–ù–ê –ë–´–õ–ê –ì–û–¢–û–í–ê'
- –ï–°–õ–ò –°–û–ó–î–ê–í–ê–ï–ú–ê–Ø –ß–ê–°–¢–¨ –ù–ï –§–ò–ù–ê–õ–¨–ù–ê–Ø, –ê –ó–ê–í–Ø–ó–ö–ê –ò–õ–ò –ö–£–õ–¨–ú–ò–ù–ê–¶–ò–Ø, –¢–û –ù–ï –î–û–ü–£–°–ö–ê–ô –í –ù–ï–ô –ó–ê–í–ï–†–®–ï–ù–ò–Ø –°–Æ–ñ–ï–¢–ê, –°–Æ–ñ–ï–¢ –î–û–õ–ñ–ï–ù –ó–ê–í–ï–†–®–ò–¢–¨–°–Ø –ü–û–ó–ñ–ï.

–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞—Å—Ç–∏ {chapter_number}, –Ω–∞—á–∏–Ω–∞—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –ö–û–¢–û–†–û–ï –õ–û–ì–ò–ß–ï–°–ö–ò –í–´–¢–ï–ö–ê–ï–¢ –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –ß–ê–°–¢–ï–ô.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
EDITOR_PROMPT = """
–¢—ã –≤–¥—É–º—á–∏–≤–æ –∏ —Å —Ñ–∞–Ω—Ç–∞–∑–∏–µ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ –∫–∞–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ —Å–æ–∞–≤—Ç–æ—Ä. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —á–∞—Å—Ç—å –∏ –ø–µ—Ä–µ–ø–∏—à–∏ –µ–µ, –æ–±–æ–≥–∞—Ç–∏–≤ –¥–µ—Ç–∞–ª—è–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π, —á—É–≤—Å—Ç–≤ –∏ –º—ã—Å–ª–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –†–ï–®–ò–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–ò–í —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

1. –ë—Ä–µ–¥–æ–≤—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–æ —Å–º—ã—Å–ª—É —Ä–µ–ø–ª–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ —Ñ—Ä–∞–∑—ã
2. –¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ—Å—Ç—É–ø–∫–æ–≤ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
3. –¢—Ä—é–∏–∑–º—ã, —Ç–∞–≤—Ç–æ–ª–æ–≥–∏—é
4. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ü–µ–ø–æ—á–∫–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ–¥–Ω–æ—Å–ª–æ–∂–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤—Ä–æ–¥–µ [–æ–Ω–∞ –±—ã–ª–∞, –æ–Ω–∞ –∑–Ω–∞–ª–∞, –æ–Ω–∞ –±—ã–ª–∞ –≥–æ—Ç–æ–≤–∞, –æ–Ω–∞ –ø–æ–Ω–∏–º–∞–ª–∞, –æ–Ω–∞ –∑–Ω–∞–ª–∞, –æ–Ω –ø–æ—Å–º–æ—Ç—Ä–µ–ª, –æ–Ω –æ—Ç–≤–µ—Ä–Ω—É–ª—Å—è, –æ–Ω –±—ã–ª –≥–æ—Ç–æ–≤]
5. –ù–µ—Å—Ç—ã–∫–æ–≤–∫–∏ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å—é–∂–µ—Ç–∞ {structure}, –≤—ã–ø–∞–≤—à–∏–µ –∏–∑ —Å—é–∂–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏, –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –ø—Ä–µ–¥–º–µ—Ç—ã
6. –°–∫—É–¥–Ω—ã–µ, –ø–ª–æ—Å–∫–∏–µ, –∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –≤—Ä–æ–¥–µ [–æ–Ω –±—ã–ª –ø–æ–¥–ª–µ—Ü–æ–º, –æ–Ω–∞ –≤—ã–≥–ª—è–¥–µ–ª–∞ –º–æ–ª–æ–¥–æ]. –û–ø–∏—Å–∞–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –≤ —Ç–µ–∫—Å—Ç–µ.

{style_instruction}

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
–ñ–∞–Ω—Ä: {genre}
–°–µ—Ç—Ç–∏–Ω–≥: {setting}
{alias_text}

## –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
{structure}

## –ü–†–ï–î–´–î–£–©–ò–ï –ß–ê–°–¢–ò (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞):
{previous_chapters_context}

## –¢–ï–ö–£–©–ê–Ø –ß–ê–°–¢–¨ {chapter_number} –î–õ–Ø –†–ï–î–ê–ö–¢–£–†–´:
{chapter_text}

## –ó–ê–î–ê–ß–ê:
–ü–µ—Ä–µ–ø–∏—à–∏ —á–∞—Å—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—é–∂–µ—Ç –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è, –Ω–æ —É–ª—É—á—à–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ:
- –û–±–æ–≥–∞—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏—è –¥–µ—Ç–∞–ª—è–º–∏
- –£–≥–ª—É–±–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —á–µ—Ä–µ–∑ –∏—Ö –º—ã—Å–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∞
- –£–±–µ—Ä–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏ —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
- –î–æ–±–∞–≤—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–æ—Ö—Ä–∞–Ω–∏ –æ–±—â–∏–π —Å—Ç–∏–ª—å –∏ —Ç–æ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –û–ë–ï–°–ü–ï–ß–¨ –ü–†–ï–ï–ú–°–¢–í–ï–ù–ù–û–°–¢–¨ –° –ü–†–ï–î–´–î–£–©–ò–ú–ò –ß–ê–°–¢–Ø–ú–ò
- –ü–†–ò–í–ï–î–ò –í –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –°–¢–†–£–ö–¢–£–†–ï –°–Æ–ñ–ï–¢–ê
- –£–ë–ï–†–ò –õ–û–ñ–ù–´–ï –ö–£–õ–¨–ú–ò–ù–ê–¶–ò–ò –ò –õ–û–ñ–ù–´–ï –ö–û–ù–¶–û–í–ö–ò, –ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–Æ–©–ò–ï –ö–†–ê–¢–ö–û–ú–£ –û–ü–ò–°–ê–ù–ò–Æ –í –°–¢–†–£–ö–¢–£–†–ï –°–Æ–ñ–ï–¢–ê

–í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞—Å—Ç–∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ—Ü–µ–Ω–∑–∏–∏ –∫—Ä–∏—Ç–∏–∫–∞
CRITIQUE_PROMPT = """
–ù–∞–ø–∏—à–∏ —Ä–µ—Ü–µ–Ω–∑–∏—é –Ω–∞ –º–æ–π —Ç–µ–∫—Å—Ç:

{full_story}

–¢–≤–æ–π —Ç–æ–Ω ‚Äî —Å—Ç—Ä–æ–≥–∏–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ª–∏—à–µ–Ω–Ω—ã–π —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç–∏.
–¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ ‚Äî —Ç–æ—á–Ω—ã–π –∏ –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π –∫ —Å–ª–∞–±—ã–º –º–µ—Å—Ç–∞–º.
–¢–≤–æ—è –∫—Ä–∏—Ç–∏–∫–∞ –≤—Å–µ–≥–¥–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞. –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—à—å –Ω–∞ –æ—à–∏–±–∫—É, –∞ –æ–±—ä—è—Å–Ω—è–µ—à—å, –ø–æ—á–µ–º—É —ç—Ç–æ –æ—à–∏–±–∫–∞, –∏ –∫–∞–∫ –µ—ë –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.
–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã–Ω–µ—Å–µ–Ω–∏—è –≤–µ—Ä–¥–∏–∫—Ç–æ–≤ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é, —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫—É—é –∏–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –º–µ—Ç–∞—Ñ–æ—Ä–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–î–∏–∞–≥–Ω–æ–∑: ...", "–ü—Ä–æ—Ç–æ–∫–æ–ª –≤—Å–∫—Ä—ã—Ç–∏—è:", "–í–µ—Ä–¥–∏–∫—Ç: ..."). 
–ü–æ—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç—É –æ—Ü–µ–Ω–∫—É –æ—Ç 10 - –æ—Ç–ª–∏—á–Ω–æ –¥–æ 0 - –∫–æ—à–º–∞—Ä–Ω–æ.
"""

def get_style_instruction(selected_style):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å—Ç–∏–ª—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞"""
    if selected_style == "none":
        return "", ""
    
    author = AUTHOR_STYLES[selected_style]
    instruction = f"\n\n## –°–¢–ò–õ–ò–°–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:\n–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç—É –∏–∑ {author['name']}:\n{author['fragment']}\n\n–°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ, —è–∑—ã–∫–æ–≤—ã–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º –∏ –º–∞–Ω–µ—Ä–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞, –Ω–æ –±–µ–∑ –ø—Ä—è–º—ã—Ö —Ü–∏—Ç–∞—Ç."
    
    return instruction, author['description']

def generate_structure(genre, setting, alias, temperature, style_instruction):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–∞—Å—Å–∫–∞–∑–∞ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        prompt = STRUCTURE_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            style_instruction=style_instruction
        )
        
        model = genai.GenerativeModel('gemini-2.0-flash-lite')
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π
        generation_config = genai.types.GenerationConfig(
            temperature=temperature,
            top_p=0.8,
            top_k=40
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: {str(e)}")
        return None

def generate_chapter(genre, setting, alias, structure, previous_chapters_context, chapter_number, chapter_details, word_count, style_instruction):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å —Ä–∞—Å—Å–∫–∞–∑–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
        if not previous_chapters_context:
            previous_chapters_context = "–≠—Ç–æ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å, –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π –Ω–µ—Ç."
        
        prompt = CHAPTER_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            structure=structure,
            previous_chapters_context=previous_chapters_context,
            chapter_number=chapter_number,
            chapter_details=chapter_details,
            word_count=word_count,
            style_instruction=style_instruction
        )
        
        model = genai.GenerativeModel('gemini-2.0-flash-lite')
        
        # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–µ–π - –Ω–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
        generation_config = genai.types.GenerationConfig(
            temperature=0.3,  # –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            top_p=0.7,
            top_k=20
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–∏ {chapter_number}: {str(e)}")
        return None

def literary_edit_chapter(genre, setting, alias, structure, previous_chapters_context, chapter_number, chapter_text, style_instruction):
    """–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —á–∞—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
        if not previous_chapters_context:
            previous_chapters_context = "–≠—Ç–æ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å, –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π –Ω–µ—Ç."
        
        prompt = EDITOR_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            structure=structure,
            previous_chapters_context=previous_chapters_context,
            chapter_number=chapter_number,
            chapter_text=chapter_text,
            style_instruction=style_instruction
        )
        
        model = genai.GenerativeModel('gemini-2.0-flash-lite')
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä - —Å—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—é–∂–µ—Ç–∞
        generation_config = genai.types.GenerationConfig(
            temperature=0.5,
            top_p=0.8,
            top_k=30
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —á–∞—Å—Ç–∏ {chapter_number}: {str(e)}")
        return chapter_text  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏

def parse_structure_for_chapters(structure_text):
    """–ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Å—Ç—è—Ö"""
    parts = []
    
    lines = structure_text.split('\n')
    current_part = None
    
    for line in lines:
        line = line.strip()
        if line.lower().startswith('—á–∞—Å—Ç—å') or line.lower().startswith('part'):
            if current_part:
                parts.append(current_part)
            current_part = {"title": line, "details": ""}
        elif current_part and line:
            current_part["details"] += line + "\n"
    
    if current_part:
        parts.append(current_part)
    
    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ 3 —á–∞—Å—Ç–µ–π
    if not parts or len(parts) != 3:
        parts = [
            {"title": "–ß–∞—Å—Ç—å 1: –ó–∞–≤—è–∑–∫–∞", "details": "–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –≥–ª–∞–≤–Ω—ã–º –≥–µ—Ä–æ–µ–º –∏ –º–∏—Ä–æ–º, –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞"},
            {"title": "–ß–∞—Å—Ç—å 2: –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è", "details": "–†–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–≤–æ—Ä–æ—Ç–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã"},
            {"title": "–ß–∞—Å—Ç—å 3: –†–∞–∑–≤—è–∑–∫–∞ –∏ —Ñ–∏–Ω–∞–ª", "details": "–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π, –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å"}
        ]
    
    return parts

def generate_critique(full_story):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏—é –æ—Ç –±–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –∫—Ä–∏—Ç–∏–∫–∞"""
    try:
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        if len(full_story) > 100000:  # –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
            full_story = full_story[:100000] + "\n\n[–¢–µ–∫—Å—Ç —Å–æ–∫—Ä–∞—â–µ–Ω –¥–ª—è —Ä–µ—Ü–µ–Ω–∑–∏–∏...]"
        
        prompt = CRITIQUE_PROMPT.format(full_story=full_story)
        
        model = genai.GenerativeModel('gemini-2.0-flash')
        
        generation_config = genai.types.GenerationConfig(
            temperature=0.7,  # –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
            top_p=0.8,
            top_k=40,
            max_output_tokens=2000  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–Ω–∑–∏–∏: {str(e)}")
        return None

def main():
    st.set_page_config(
        page_title="–ì—Ä–∞—Ñ–æ–º–∞–Ω—ä: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–∫–∞–∑–æ–≤",
        page_icon="üìñ",
        layout="wide"
    )
    
    st.title("üìñ –ì—Ä–∞—Ñ–æ–º–∞–Ω—ä: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–∫–∞–∑–æ–≤")
    st.markdown("–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Å–∫–∞–∑—ã –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –∂–∞–Ω—Ä–µ –∏ —Å–µ—Ç—Ç–∏–Ω–≥–µ")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state
    if 'current_step' not in st.session_state:
        st.session_state.current_step = 1  # 1: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, 2: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, 3: —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if 'full_story' not in st.session_state:
        st.session_state.full_story = ""
    
    if 'edited_story' not in st.session_state:
        st.session_state.edited_story = ""  # –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
    
    if 'critique' not in st.session_state:
        st.session_state.critique = None
    
    if 'is_generating_critique' not in st.session_state:
        st.session_state.is_generating_critique = False
        
    if 'structure' not in st.session_state:
        st.session_state.structure = None
        
    if 'parts_info' not in st.session_state:
        st.session_state.parts_info = []
        
    if 'current_part' not in st.session_state:
        st.session_state.current_part = 0
        
    if 'previous_chapters_context' not in st.session_state:
        st.session_state.previous_chapters_context = ""  # –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
        
    if 'selected_style' not in st.session_state:
        st.session_state.selected_style = "none"
    
    # –®–∞–≥ 1: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å–∫–∞–∑–∞
    if st.session_state.current_step == 1:
        st.header("1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å–∫–∞–∑–∞")
        
        col1, col2 = st.columns(2)
        
        with col1:
            genre = st.text_input(
                "–ñ–∞–Ω—Ä –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:",
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ñ—ç–Ω—Ç–µ–∑–∏, –Ω–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤, —Ä–æ–º–∞–Ω...",
                help="–£–∫–∞–∂–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∂–∞–Ω—Ä –≤–∞—à–µ–≥–æ —Ä–∞—Å—Å–∫–∞–∑–∞"
            )
        
        with col2:
            setting = st.text_input(
                "–°–µ—Ç—Ç–∏–Ω–≥ (–º–µ—Å—Ç–æ –∏ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è):",
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ, –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è –≤ 2250 –≥–æ–¥—É...",
                help="–û–ø–∏—à–∏—Ç–µ –º–∏—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–µ"
            )
        
        # –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –∞–≤—Ç–æ—Ä–∞
        st.header("üé≠ –°—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞")
        st.info("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–∞—Å—Å–∫–∞–∑–∞")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è selected_style –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if 'selected_style' not in st.session_state:
            st.session_state.selected_style = "none"
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å—Ç–∏–ª–µ–π
        style_col1, style_col2, style_col3, style_col4 = st.columns(4)
        
        with style_col1:
            if st.button("üìö –ë–µ–∑ —Å—Ç–∏–ª—è", use_container_width=True, key="style_none"):
                st.session_state.selected_style = "none"
                st.rerun()
        with style_col2:
            if st.button("‚öúÔ∏è –¢–æ–ª—Å—Ç–æ–π", use_container_width=True, key="style_tolstoy"):
                st.session_state.selected_style = "tolstoy"
                st.rerun()
        with style_col3:
            if st.button("üåÄ –ü–µ–ª–µ–≤–∏–Ω", use_container_width=True, key="style_pelevin"):
                st.session_state.selected_style = "pelevin"
                st.rerun()
        with style_col4:
            if st.button("ü¶ã –ù–∞–±–æ–∫–æ–≤", use_container_width=True, key="style_nabokov"):
                st.session_state.selected_style = "nabokov"
                st.rerun()
        
        # –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è
        st.markdown("---")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
        if st.session_state.selected_style != "none":
            author = AUTHOR_STYLES[st.session_state.selected_style]
            st.success(f"**–í—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å:** {author['name']}")
            st.info(f"**–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏–ª—è:** {author['description']}")
            
            with st.expander("üìñ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Å—Ç–∏–ª—è"):
                st.text_area("–§—Ä–∞–≥–º–µ–Ω—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", author['fragment'], height=200, key=f"fragment_{st.session_state.selected_style}")
        else:
            st.info("‚ö™ –°—Ç–∏–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω - –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Å—Ç–∏–ª—å")
        
        # –ü–æ–ª–∑—É–Ω–æ–∫ —Ñ–∞–Ω—Ç–∞–∑–∏–∏
        st.header("2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞")
        
        creativity = st.slider(
            "–£—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏ –ø–∏—Å–∞—Ç–µ–ª—è:",
            min_value=0.1,
            max_value=1.0,
            value=0.7,
            step=0.1,
            help=(
                "–ù–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—é–∂–µ—Ç, —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä—É\n"
                "–í—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—é–∂–µ—Ç, –≤–æ–∑–º–æ–∂–Ω—ã —Å–º–µ—à–µ–Ω–∏—è –∂–∞–Ω—Ä–æ–≤"
            )
        )
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∫ —É—Ä–æ–≤–Ω—é —Ñ–∞–Ω—Ç–∞–∑–∏–∏
        creativity_descriptions = {
            0.1: "ü§ñ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å - —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–æ–Ω–∞–º –∂–∞–Ω—Ä–∞",
            0.2: "üìö –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤",
            0.3: "üìù –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–µ–∞–ª–∏–∑–º - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å—é –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º", 
            0.4: "üé≠ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–æ–≤–∏–∑–Ω—ã",
            0.5: "‚ú® –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å - —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–µ–π",
            0.6: "üåü –¢–≤–æ—Ä—á–µ—Å–∫–∏–π - –∑–∞–º–µ—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å—é–∂–µ—Ç–µ",
            0.7: "üöÄ –í—ã—Å–æ–∫–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è - –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —à–∞–±–ª–æ–Ω–æ–≤",
            0.8: "üé® –û—á–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π - —Å–º–µ–ª—ã–µ —Å—é–∂–µ—Ç–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è",
            0.9: "üî• –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π",
            1.0: "‚ö° –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—é–∂–µ—Ç"
        }
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        current_description = creativity_descriptions.get(creativity, "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥")
        st.info(f"**–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:** {current_description}")
        
        st.header("3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)")
        alias = st.text_area(
            "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:",
            height=100,
            placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏—Å—Ç–æ—Ä–∏—è –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–µ, –ø–æ–ø–∞–≤—à–µ–º –≤ –º–∏—Ä –º–∞–≥–∏–∏, –≥–¥–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∑–∞–º–µ–Ω—è—é—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è...",
            help="–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –∏–¥–µ–∏ –¥–ª—è —Å—é–∂–µ—Ç–∞"
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ session_state
        st.session_state.genre = genre
        st.session_state.setting = setting
        st.session_state.creativity = creativity
        st.session_state.alias = alias
        
        # –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        if st.button("üé≠ –ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å–∫–∞–∑–∞", type="primary", key="start_creation"):
            if not genre or not setting:
                st.warning("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥")
            else:
                st.session_state.current_step = 2
                st.rerun()
    
    # –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å—Å–∫–∞–∑–∞
    elif st.session_state.current_step == 2:
        genre = st.session_state.genre
        setting = st.session_state.setting
        creativity = st.session_state.creativity
        alias = st.session_state.alias
        selected_style = st.session_state.selected_style
        
        st.header("üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å—Å–∫–∞–∑–∞")
        st.info(f"**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ñ–∞–Ω—Ä: {genre}, –°–µ—Ç—Ç–∏–Ω–≥: {setting}, –§–∞–Ω—Ç–∞–∑–∏—è: {creativity}")
        
        if selected_style != "none":
            author_name = AUTHOR_STYLES[selected_style]['name']
            st.info(f"üé® **–°—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞:** {author_name}")
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å—Ç–∏–ª—é
        style_instruction, style_description = get_style_instruction(selected_style)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞)
        if st.session_state.structure is None:
            with st.spinner("üìê –°–æ–∑–¥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è..."):
                structure = generate_structure(genre, setting, alias, creativity, style_instruction)
                
                if not structure:
                    st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
                    if st.button("üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"):
                        st.rerun()
                    return
                
                st.session_state.structure = structure
                st.success("‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞!")
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        st.divider()
        st.header("üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
        st.text_area("–°—Ç—Ä—É–∫—Ç—É—Ä–∞:", st.session_state.structure, height=400, key="structure_display")
        
        # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Å—Ç—è—Ö (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â–µ –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–∞)
        if not st.session_state.parts_info:
            st.session_state.parts_info = parse_structure_for_chapters(st.session_state.structure)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∞—Å—Ç–µ–π
        st.divider()
        st.header("üñãÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —á–∞—Å—Ç–µ–π")
        st.info("üìù –ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—Å—Ç–∞ –í–°–ï–• –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—é–∂–µ—Ç–∞")
        
        parts_count = len(st.session_state.parts_info)
        words_per_part = 8000  # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –Ω–∞ —á–∞—Å—Ç—å
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        progress_bar = st.progress(st.session_state.current_part / parts_count)
        status_text = st.empty()
        
        # –ï—Å–ª–∏ –≤—Å–µ —á–∞—Å—Ç–∏ —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 3
        if st.session_state.current_part >= parts_count:
            st.session_state.current_step = 3
            st.success("üéâ –†–∞—Å—Å–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω!")
            st.rerun()
            return
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —á–∞—Å—Ç—å
        part_num = st.session_state.current_part
        part_info = st.session_state.parts_info[part_num]
        part_details = f"{part_info['title']}\n{part_info['details']}"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —á–∞—Å—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        st.subheader(f"–ß–∞—Å—Ç—å {part_num + 1}: {part_info['title']}")
        st.write(part_info['details'])
        
        status_text.text(f"–ü–∏—à—É —á–∞—Å—Ç—å {part_num + 1} –∏–∑ {parts_count}...")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∞—Å—Ç—å —Å —É—á–µ—Ç–æ–º –í–°–ï–• –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
        part_text = generate_chapter(
            genre, setting, alias, st.session_state.structure,
            st.session_state.previous_chapters_context,  # –ü–µ—Ä–µ–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
            part_num + 1, 
            part_details, 
            words_per_part,
            style_instruction
        )
        
        if part_text:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–∞—Å—Ç—å –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            with st.spinner(f"‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä—É—é —á–∞—Å—Ç—å {part_num + 1}..."):
                edited_part_text = literary_edit_chapter(
                    genre, setting, alias, st.session_state.structure,
                    st.session_state.previous_chapters_context,  # –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç–µ–π
                    part_num + 1,
                    part_text,
                    style_instruction
                )
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –∫ –ø–æ–ª–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
            st.session_state.full_story += f"\n\n–ß–ê–°–¢–¨ {part_num + 1}: {part_info['title']}\n\n{part_text}"
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç—å –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
            st.session_state.edited_story += f"\n\n–ß–ê–°–¢–¨ {part_num + 1}: {part_info['title']}\n\n{edited_part_text}"
            
            # –û–ë–ù–û–í–õ–Ø–ï–ú –ö–û–ù–¢–ï–ö–°–¢ –ü–†–ï–î–´–î–£–©–ò–• –ß–ê–°–¢–ï–ô - –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç—å
            if st.session_state.previous_chapters_context:
                st.session_state.previous_chapters_context += f"\n\n--- –ß–ê–°–¢–¨ {part_num + 1} ---\n{edited_part_text}"
            else:
                st.session_state.previous_chapters_context = f"--- –ß–ê–°–¢–¨ {part_num + 1} ---\n{edited_part_text}"
            
            st.success(f"‚úÖ –ß–∞—Å—Ç—å {part_num + 1} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞")
            
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏
            st.session_state.current_part += 1
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progress_bar.progress(st.session_state.current_part / parts_count)
            
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏
            st.rerun()
            
        else:
            st.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —á–∞—Å—Ç–∏ {part_num + 1}")
            if st.button("üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"):
                st.rerun()
    
    # –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Ä–µ—Ü–µ–Ω–∑–∏—è
    elif st.session_state.current_step == 3:
        st.header("üìò –ì–æ—Ç–æ–≤—ã–π —Ä–∞—Å—Å–∫–∞–∑")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
        if st.session_state.selected_style != "none":
            author_name = AUTHOR_STYLES[st.session_state.selected_style]['name']
            st.success(f"üé® **–°—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞:** {author_name}")
        
        # –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
        version = st.radio(
            "–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:",
            ["üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)", "‚ö™ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è"],
            index=0
        )
        
        # –í—ã–±–∏—Ä–∞–µ–º –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
        display_story = st.session_state.edited_story if version.startswith("üìù") else st.session_state.full_story
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑
        st.text_area("–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å–∫–∞–∑–∞:", display_story, height=600, key="full_story_display")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        word_count = len(display_story.split())
        st.sidebar.header("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
        st.sidebar.write(f"–û–±—â–∏–π –æ–±—ä–µ–º: {word_count} —Å–ª–æ–≤")
        st.sidebar.write(f"–£—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏: {st.session_state.creativity}")
        st.sidebar.write(f"–í–µ—Ä—Å–∏—è: {'–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è' if version.startswith('üìù') else '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è'}")
        if st.session_state.selected_style != "none":
            st.sidebar.write(f"–°—Ç–∏–ª—å: {AUTHOR_STYLES[st.session_state.selected_style]['name']}")
        
        # –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        st.divider()
        st.header("üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
        
        col1, col2 = st.columns(2)
        
        with col1:
            # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞–∫ TXT
            b64_txt = base64.b64encode(display_story.encode()).decode()
            version_suffix = "_–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è" if version.startswith("üìù") else "_–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è"
            style_suffix = f"_{st.session_state.selected_style}" if st.session_state.selected_style != "none" else ""
            href_txt = f'<a href="data:file/txt;base64,{b64_txt}" download="—Ä–∞—Å—Å–∫–∞–∑_{st.session_state.genre}{style_suffix}{version_suffix}.txt">üì• –°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT</a>'
            st.markdown(href_txt, unsafe_allow_html=True)
        
        with col2:
            # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            if st.button("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞", key="copy_full"):
                st.code(display_story, language="markdown")
                st.success("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!")

        # –†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –∫—Ä–∏—Ç–∏–∫–∞
        st.divider()
        st.header("üéØ –†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞")
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–µ
        if st.session_state.critique:
            st.subheader("–†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞")
            st.text_area("", st.session_state.critique, height=400, key="critique_display")
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
            if st.button("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", key="copy_critique"):
                st.code(st.session_state.critique, language="markdown")
                st.success("–†–µ—Ü–µ–Ω–∑–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!")
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
            if st.button("üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", key="refresh_critique"):
                st.session_state.critique = None
                st.session_state.is_generating_critique = False
                st.rerun()
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
        elif st.session_state.is_generating_critique:
            with st.spinner("üîç –ö—Ä–∏—Ç–∏–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç"):
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
                critique = generate_critique(st.session_state.edited_story)
                if critique:
                    st.session_state.critique = critique
                    st.session_state.is_generating_critique = False
                    st.rerun()  # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                else:
                    st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é")
                    st.session_state.is_generating_critique = False
                    st.rerun()
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è –µ—â–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å
        else:
            st.info("""
            **–ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Ä–µ—Ü–µ–Ω–∑–∏—é –Ω–∞ –≤–∞—à —Ä–∞—Å—Å–∫–∞–∑:**
            - –°—Ç—Ä–æ–≥–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∏–ª—å–Ω—ã—Ö –∏ —Å–ª–∞–±—ã—Ö —Å—Ç–æ—Ä–æ–Ω
            - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
            - –û—Ü–µ–Ω–∫–∞ –ø–æ 10-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ
            - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—Ä–∏—Ç–∏–∫–∞ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π/—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –º–µ—Ç–∞—Ñ–æ—Ä–∏–∫–æ–π
            """)
            
            if st.button("üìù –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞", type="secondary"):
                st.session_state.is_generating_critique = True
                st.rerun()
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—Å–∫–∞–∑–∞
        st.divider()
        if st.button("üîÑ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Å—Å–∫–∞–∑", type="primary"):
            # –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            for key in list(st.session_state.keys()):
                del st.session_state[key]
            st.rerun()

    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
    st.sidebar.header("üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
    st.sidebar.info("""
    **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
    - **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–∑—É–Ω–∫–æ–º (0.1-1.0)
    - **–ß–∞—Å—Ç–∏:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.3 –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    - **–†–µ–¥–∞–∫—Ç–æ—Ä:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.5 –¥–ª—è –±–∞–ª–∞–Ω—Å–∞
    
    üî• –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ = –±–æ–ª—å—à–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
    ‚ùÑÔ∏è –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ = –±–æ–ª—å—à–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏
    """)
    
    st.sidebar.header("üé≠ –°—Ç–∏–ª–∏ –∞–≤—Ç–æ—Ä–æ–≤")
    st.sidebar.info("""
    **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∏–ª–∏:**
    - **–¢–æ–ª—Å—Ç–æ–π:** –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞, —ç–ø–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–∞—Ö
    - **–ü–µ–ª–µ–≤–∏–Ω:** –ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º, –∏—Ä–æ–Ω–∏—è, —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è  
    - **–ù–∞–±–æ–∫–æ–≤:** –õ–∏—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∑–∞, –≤–∏—Ä—Ç—É–æ–∑–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ —è–∑—ã–∫–æ–º
    
    –°—Ç–∏–ª—å –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ —ç—Ç–∞–ø—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á–∞—Å—Ç–∏ –∏ —Ä–µ–¥–∞–∫—Ç—É—Ä—É.
    """)
    
    st.sidebar.header("‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏")
    st.sidebar.info("""
    **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–∫–∞–∑–æ–≤** —Å–æ–∑–¥–∞–µ—Ç –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è 
    –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    
    **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
    1. –£–∫–∞–∂–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥
    2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏
    4. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–¥–µ—é (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
    5. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å–∫–∞–∑–∞"
    6. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    """)

if __name__ == "__main__":
    main()
