import streamlit as st
import google.generativeai as genai
import base64

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
api_key = st.secrets.get('GEMINI_API_KEY')
if not api_key:
    st.error("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GEMINI_API_KEY –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö Streamlit")
    st.stop()

genai.configure(api_key=api_key)

# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
STRUCTURE_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç. –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏.

## –ó–∞–¥–∞—á–∞:
–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏ –≤ –∂–∞–Ω—Ä–µ {genre} —Å —Å–µ—Ç—Ç–∏–Ω–≥–æ–º: {setting}
{alias_text}

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—é–∂–µ—Ç–∞** (–ø–æ –∫–∞–Ω–æ–Ω–∞–º "–∑–∞–≤—è–∑–∫–∞-–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è-—Ä–∞–∑–≤—è–∑–∫–∞-—Ñ–∏–Ω–∞–ª"):
   - –ó–∞–≤—è–∑–∫–∞: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–∏—Ä–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
   - –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è: —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
   - –†–∞–∑–≤—è–∑–∫–∞: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
   - –§–∏–Ω–∞–ª: –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å, –≤—ã–≤–æ–¥—ã

2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≥–ª–∞–≤** (–º–∏–Ω–∏–º—É–º 8 –≥–ª–∞–≤, –æ–±—â–∏–π –æ–±—ä–µ–º –Ω–µ –º–µ–Ω–µ–µ 8000 —Å–ª–æ–≤):
   –î–ª—è –∫–∞–∂–¥–æ–π –≥–ª–∞–≤—ã —É–∫–∞–∂–∏:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã
   - –î–µ–π—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Ü–∞
   - –°–∏–Ω–æ–ø—Å–∏—Å: –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
   - –õ–æ–∫–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
   - –£—á–∞—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
   - –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –≤ —Å–ª–æ–≤–∞—Ö

3. **–ü–µ—Ä—Å–æ–Ω–∞–∂–∏** (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ):
   - –ò–º—è –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –•–∞—Ä–∞–∫—Ç–µ—Ä, –º–æ—Ç–∏–≤–∞—Ü–∏—è
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç
   - –†–æ–ª—å –∏ –¥–≤–∏–∂—É—â–∞—è —Å–∏–ª–∞ –≤ —Å—é–∂–µ—Ç–µ

4. **–õ–æ–∫–∞—Ü–∏–∏** - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è

5. **–ü—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã** - –∑–Ω–∞—á–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å—é–∂–µ—Ç–µ

6. **–ö—Ä–∞—Ç–∫–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞** - –æ–±—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª–∞

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–π, —á—Ç–æ–±—ã —Å–ª—É–∂–∏—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–≤–µ—Å—Ç–∏.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥–ª–∞–≤
CHAPTER_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å. –ù–∞–ø–∏—à–∏ –≥–ª–∞–≤—É –ø–æ–≤–µ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç:
–ñ–∞–Ω—Ä: {genre}
–°–µ—Ç—Ç–∏–Ω–≥: {setting}
{alias_text}

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:
{structure}

## –ó–∞–¥–∞—á–∞ –≥–ª–∞–≤—ã {chapter_number}:
{chapter_details}

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –û–±—ä–µ–º: –ø—Ä–∏–º–µ—Ä–Ω–æ {word_count} —Å–ª–æ–≤
- –°—Ç–∏–ª—å: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∂–∞–Ω—Ä—É {genre}
- –†–∞–∑–≤–∏—Ç–∏–µ —Å—é–∂–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ü—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–±—ã—Ç–∏–π (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- –Ø—Ä–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—â–µ–π —Ñ–∞–±—É–ª–µ)

–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã, –Ω–∞—á–∏–Ω–∞—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è.
"""

def generate_structure(genre, setting, alias):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        prompt = STRUCTURE_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text
        )
        
        model = genai.GenerativeModel('gemini-1.5-flash')
        response = model.generate_content(prompt)
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: {str(e)}")
        return None

def generate_chapter(genre, setting, alias, structure, chapter_number, chapter_details, word_count):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–ª–∞–≤—É –ø–æ–≤–µ—Å—Ç–∏"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        prompt = CHAPTER_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            structure=structure,
            chapter_number=chapter_number,
            chapter_details=chapter_details,
            word_count=word_count
        )
        
        model = genai.GenerativeModel('gemini-1.5-flash')
        response = model.generate_content(prompt)
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤—ã {chapter_number}: {str(e)}")
        return None

def main():
    st.set_page_config(
        page_title="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π",
        page_icon="üìñ",
        layout="wide"
    )
    
    st.title("üìñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π")
    st.markdown("–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–≤–µ—Å—Ç–∏ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –∂–∞–Ω—Ä–µ –∏ —Å–µ—Ç—Ç–∏–Ω–≥–µ")
    
    # –°–µ–∫—Ü–∏—è –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    st.header("1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤–µ—Å—Ç–∏")
    
    col1, col2 = st.columns(2)
    
    with col1:
        genre = st.text_input(
            "–ñ–∞–Ω—Ä –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:",
            placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ñ—ç–Ω—Ç–µ–∑–∏, –Ω–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤, —Ä–æ–º–∞–Ω...",
            help="–£–∫–∞–∂–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∂–∞–Ω—Ä –≤–∞—à–µ–π –ø–æ–≤–µ—Å—Ç–∏"
        )
    
    with col2:
        setting = st.text_input(
            "–°–µ—Ç—Ç–∏–Ω–≥ (–º–µ—Å—Ç–æ –∏ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è):",
            placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ, –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è –≤ 2250 –≥–æ–¥—É...",
            help="–û–ø–∏—à–∏—Ç–µ –º–∏—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–µ"
        )
    
    st.header("2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)")
    alias = st.text_area(
        "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:",
        height=100,
        placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏—Å—Ç–æ—Ä–∏—è –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–µ, –ø–æ–ø–∞–≤—à–µ–º –≤ –º–∏—Ä –º–∞–≥–∏–∏, –≥–¥–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∑–∞–º–µ–Ω—è—é—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è...",
        help="–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –∏–¥–µ–∏ –¥–ª—è —Å—é–∂–µ—Ç–∞"
    )
    
    # –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    st.header("3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–≤–µ—Å—Ç–∏")
    
    if st.button("üé≠ –ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Å—Ç–∏", type="primary"):
        if not genre or not setting:
            st.warning("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥")
            return
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        with st.spinner("üìê –°–æ–∑–¥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è..."):
            structure = generate_structure(genre, setting, alias)
            
            if not structure:
                st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
                return
            
            st.success("‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞!")
            
            # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            st.divider()
            st.header("üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
            st.text_area("–°—Ç—Ä—É–∫—Ç—É—Ä–∞:", structure, height=400, key="structure")
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª–∞–≤
        st.divider()
        st.header("üñãÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ –≥–ª–∞–≤")
        
        # –ó–¥–µ—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –±—ã–ª–æ –±—ã —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        # —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª–∞–≤ –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–µ
        # –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –±—É–¥–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 8 –≥–ª–∞–≤
        
        full_story = ""
        progress_bar = st.progress(0)
        status_text = st.empty()
        
        chapters_count = 8  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª–∞–≤
        words_per_chapter = 1000  # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –Ω–∞ –≥–ª–∞–≤—É
        
        for chapter_num in range(1, chapters_count + 1):
            status_text.text(f"–ü–∏—à—É –≥–ª–∞–≤—É {chapter_num} –∏–∑ {chapters_count}...")
            
            # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≥–ª–∞–≤—ã –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            chapter_details = f"–ì–ª–∞–≤–∞ {chapter_num} - —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—é–∂–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ"
            
            chapter_text = generate_chapter(
                genre, setting, alias, structure, 
                chapter_num, chapter_details, words_per_chapter
            )
            
            if chapter_text:
                full_story += f"\n\n–ì–õ–ê–í–ê {chapter_num}\n\n{chapter_text}"
                st.success(f"‚úÖ –ì–ª–∞–≤–∞ {chapter_num} –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
            else:
                st.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –≥–ª–∞–≤—ã {chapter_num}")
                break
            
            progress_bar.progress(chapter_num / chapters_count)
        
        if full_story.strip():
            # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª–Ω—É—é –ø–æ–≤–µ—Å—Ç—å
            st.divider()
            st.header("üìò –ì–æ—Ç–æ–≤–∞—è –ø–æ–≤–µ—Å—Ç—å")
            
            st.text_area("–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–≤–µ—Å—Ç–∏:", full_story, height=600, key="full_story")
            
            # –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
            st.divider()
            st.header("üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
            
            col1, col2 = st.columns(2)
            
            with col1:
                # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞–∫ TXT
                b64_txt = base64.b64encode(full_story.encode()).decode()
                href_txt = f'<a href="data:file/txt;base64,{b64_txt}" download="–ø–æ–≤–µ—Å—Ç—å_{genre}.txt">üì• –°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT</a>'
                st.markdown(href_txt, unsafe_allow_html=True)
            
            with col2:
                # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                if st.button("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞"):
                    st.code(full_story, language="markdown")
                    st.success("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!")
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
    st.sidebar.header("‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏")
    st.sidebar.info("""
    **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π** —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è 
    –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    
    **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
    1. –£–∫–∞–∂–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥
    2. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–¥–µ—é (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
    3. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Å—Ç–∏"
    4. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    
    **–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è:**
    - –°–Ω–∞—á–∞–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    - –ó–∞—Ç–µ–º –ø–∏—à—É—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥–ª–∞–≤—ã
    - –û–±—â–∏–π –æ–±—ä–µ–º: ~8000 —Å–ª–æ–≤
    - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–Ω–æ–Ω–∞–º –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞
    """)
    
    st.sidebar.header("üé≠ –ü–æ–¥—Å–∫–∞–∑–∫–∏")
    st.sidebar.write("""
    - –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∂–∞–Ω—Ä–∞
    - –î–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—à–∏—Ç–µ —Å–µ—Ç—Ç–∏–Ω–≥ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è
    - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–¥–µ—é –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Å—é–∂–µ—Ç–∞
    - –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è - –ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏!
    """)

if __name__ == "__main__":
    main()
