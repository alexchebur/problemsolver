import streamlit as st
import google.generativeai as genai
import base64
import time

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
api_key = st.secrets.get('GEMINI_API_KEY')
if not api_key:
    st.error("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GEMINI_API_KEY –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö Streamlit")
    st.stop()

genai.configure(api_key=api_key)

# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
STRUCTURE_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç. –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏.

## –ó–∞–¥–∞—á–∞:
–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏ –≤ –∂–∞–Ω—Ä–µ {genre} —Å —Å–µ—Ç—Ç–∏–Ω–≥–æ–º: {setting}
{alias_text}

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—é–∂–µ—Ç–∞** (–ø–æ –∫–∞–Ω–æ–Ω–∞–º "–∑–∞–≤—è–∑–∫–∞-–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è-—Ä–∞–∑–≤—è–∑–∫–∞-—Ñ–∏–Ω–∞–ª"):
   - –ó–∞–≤—è–∑–∫–∞: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–∏—Ä–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ (–≥–ª–∞–≤—ã 1-2)
   - –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è: —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–≥–ª–∞–≤—ã 3-6)
   - –†–∞–∑–≤—è–∑–∫–∞: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π (–≥–ª–∞–≤—ã 7-8)
   - –§–∏–Ω–∞–ª: –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å, –≤—ã–≤–æ–¥—ã (–≥–ª–∞–≤–∞ 9)

2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≥–ª–∞–≤** (9 –≥–ª–∞–≤,  –æ–±—ä–µ–º –∫–∞–∂–¥–æ–π –≥–ª–∞–≤—ã –Ω–µ –º–µ–Ω–µ–µ 8000 —Å–ª–æ–≤):
   –î–ª—è –∫–∞–∂–¥–æ–π –≥–ª–∞–≤—ã —É–∫–∞–∂–∏:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã
   - –î–µ–π—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Ü–∞
   - –°–∏–Ω–æ–ø—Å–∏—Å: –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
   - –õ–æ–∫–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
   - –£—á–∞—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
   - –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –≤ —Å–ª–æ–≤–∞—Ö

3. **–ü–µ—Ä—Å–æ–Ω–∞–∂–∏** (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ):
   - –ò–º—è –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –•–∞—Ä–∞–∫—Ç–µ—Ä, –º–æ—Ç–∏–≤–∞—Ü–∏—è
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç
   - –†–æ–ª—å –∏ –¥–≤–∏–∂—É—â–∞—è —Å–∏–ª–∞ –≤ —Å—é–∂–µ—Ç–µ
   - –ö–∞–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—É—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —Å—é–∂–µ—Ç–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

4. **–õ–æ–∫–∞—Ü–∏–∏** - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è

5. **–ü—Ä–µ–¥–º–µ—Ç—ã/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã** - –∑–Ω–∞—á–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å—é–∂–µ—Ç–µ

6. **–ö—Ä–∞—Ç–∫–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞** - –æ–±—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª–∞

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–π, —á—Ç–æ–±—ã —Å–ª—É–∂–∏—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–≤–µ—Å—Ç–∏.

##–ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç —Å—é–∂–µ—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–π –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑ 36 —Ç–∏–ø–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–≤–µ—Å—Ç–∏):
1.–ú–æ–ª—å–±–∞ –æ –∑–∞—Å—Ç—É–ø–Ω–∏—á–µ—Å—Ç–≤–µ
–ü—Ä–∏—Ç–µ—Å–Ω–∏—Ç–µ–ª—å; –ü—Ä–æ—Å–∏—Ç–µ–ª—å; –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å –≤–ª–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
–ü—Ä–æ—Å–∏—Ç–µ–ª—å –º–æ–ª–∏—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –≤–ª–∞—Å—Ç–∏ –æ –∑–∞—â–∏—Ç–µ –æ—Ç –ø—Ä–∏—Ç–µ—Å–Ω–∏—Ç–µ–ª—è. –ü—Ä–æ—Å–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –¥–≤—É—Ö –ª–∏—Ü–∞—Ö - –ñ–µ—Ä—Ç–≤–∞ –∏ –ó–∞—Å—Ç—É–ø–Ω–∏–∫. –ü—Ä–∏–º–µ—Ä:–ï—Å—Ñ–∏—Ä—å, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ø—Ä–æ—Å–∏–ª–∞ –ø–µ—Ä—Å–∏–¥—Å–∫–æ–≥–æ —Ü–∞—Ä—è –∑–∞—Å—Ç—É–ø–∏—Ç—å—Å—è –∑–∞ –µ–≤—Ä–µ–π—Å–∫–∏–π –Ω–∞—Ä–æ–¥ –∏ –∑–∞—â–∏—Ç–∏—Ç—å –µ–≥–æ –æ—Ç –ø—Ä–æ–∏—Å–∫–æ–≤ –∑–ª–æ–≥–æ —Ü–∞—Ä–µ–¥–≤–æ—Ä—Ü–∞ –ê–º–∞–Ω–∞.
2.–°–ø–∞—Å–µ–Ω–∏–µ
–ù–µ–≤–µ–∑—É—á–∏–π; –£–≥—Ä–æ–∂–∞—é—â–∏–π; –°–ø–∞—Å–∏—Ç–µ–ª—å.
–ù–µ–≤–µ–∑—É—á–∏–π —Å—Ç–∞–ª –ø—Ä–∏—á–∏–Ω–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏ –£–≥—Ä–æ–∂–∞—é—â–∏–π —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –µ–º—É –æ—Ç–æ–º—Å—Ç–∏—Ç—å. –ù–æ –°–ø–∞—Å–∏—Ç–µ–ª—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ–º–æ—â—å –ù–µ–≤–µ–∑—É—á–µ–º—É. –ü—Ä–∏–º–µ—Ä—ã: –ò—Ñ–∏–≥–µ–Ω–∏—è –≤ –¢–∞–≤—Ä–∏–¥–µ, –ò–∑–±–∞–≤–ª–µ–Ω–∏–µ.
3.–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –ú–µ—Å—Ç—å
–ü—Ä–µ—Å—Ç—É–ø–Ω–∏–∫; –ú—Å—Ç–∏—Ç–µ–ª—å.
–ü—Ä–µ—Å—Ç—É–ø–Ω–∏–∫ —Å–æ–≤–µ—Ä—à–∞–µ—Ç –∑–ª–æ–¥–µ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Å—Ç–∞–ª–æ—Å—å –±–µ–∑–Ω–∞–∫–∞–∑–∞–Ω–Ω—ã–º, –∏ –ú—Å—Ç–∏—Ç–µ–ª—å –≤–µ—Ä—à–∏—Ç –ø—Ä–∞–≤–æ—Å—É–¥–∏–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –ü—Ä–∏–º–µ—Ä: –ì—Ä–∞—Ñ –ú–æ–Ω—Ç–µ-–ö—Ä–∏—Å—Ç–æ.
4.–ö—Ä–æ–≤–Ω–∞—è –º–µ—Å—Ç—å
–í–∏–Ω–æ–≤–Ω—ã–π –†–æ–¥–∏—á, –ú—Å—Ç—è—â–∏–π –†–æ–¥–∏—á, –ø–∞–º—è—Ç—å –æ –ñ–µ—Ä—Ç–≤–µ, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º –æ–±–µ–∏–º —Å—Ç–æ—Ä–æ–Ω–∞–º.
–†–æ–¥–∏—á–∏ –≤—Å—Ç—É–ø–∞—é—Ç –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–∑-–∑–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è, —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ñ–µ—Ä—Ç–≤–µ. –ü—Ä–∏–º–µ—Ä: –ì–∞–º–ª–µ—Ç.
5. –ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
–ë–µ–≥–ª–µ—Ü; –∫–∞—Ä–∞
–ë–µ–≥–ª–µ—Ü –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–±–µ–≥–∞—Ç—å –∫–∞—Ä—ã –∑–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω –Ω–µ —Å–æ–≤–µ—Ä—à–∞–ª. –ü—Ä–∏–º–µ—Ä—ã: –û—Ç–≤–µ—Ä–∂–µ–Ω–Ω—ã–µ, –ë–µ–≥–ª–µ—Ü.
6.–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞
–ü–æ–±–µ–∂–¥–µ–Ω–Ω—ã–π, –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–ª–∏ –ü–æ—Å–ª–∞–Ω–µ—Ü
–ü–æ–±–µ–∂–¥–µ–Ω–Ω—ã–π —Ç–µ—Ä–ø–∏—Ç –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –ü–æ–±–µ–¥–∏—Ç–µ–ª—è –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–∞–Ω–∏–µ –æ —Ç–∞–∫–æ–º –ø–æ—Ä–∞–∂–µ–Ω–∏–∏ –æ—Ç –ü–æ—Å–ª–∞–Ω—Ü–∞. –ü—Ä–∏–º–µ—Ä: –ê–≥–∞–º–µ–º–Ω–æ–Ω.
7.–ñ–µ—Ä—Ç–≤–∞
–ñ–µ—Ä—Ç–≤–∞; –•–æ–∑—è–∏–Ω –∏–ª–∏ –Ω–µ–∫–æ–µ –±–µ–¥—Å—Ç–≤–∏–µ
–ñ–µ—Ä—Ç–≤–∞ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤ –∏–ª–∏ –æ—Ç —Ä—É–∫ –•–æ–∑—è–∏–Ω–∞. –ü—Ä–∏–º–µ—Ä: –ò–æ–≤.
8.–ë—É–Ω—Ç
–¢–∏—Ä–∞–Ω; –ó–∞–≥–æ–≤–æ—Ä—â–∏–∫
–ó–∞–≥–æ–≤–æ—Ä—â–∏–∫ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–≤–µ—Ä–≥–Ω—É—Ç—å —Ç–∏—Ä–∞–Ω–∞. –ü—Ä–∏–º–µ—Ä: –Æ–ª–∏–π –¶–µ–∑–∞—Ä—å.
9.–û—Ç–≤–∞–∂–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
–û—Ç–≤–∞–∂–Ω—ã–π –ª–∏–¥–µ—Ä; –ø—Ä–µ–¥–º–µ—Ç; –í—Ä–∞–≥
–û—Ç–≤–∞–∂–Ω—ã–π –ª–∏–¥–µ—Ä –ø–æ–±–µ–∂–¥–∞–µ—Ç –í—Ä–∞–≥–∞ –∏ –∑–∞–±–∏—Ä–∞–µ—Ç —É –Ω–µ–≥–æ –ø—Ä–µ–¥–º–µ—Ç. –ü—Ä–∏–º–µ—Ä—ã:–õ–∞–Ω—Å–µ–ª–æ—Ç-–ì—Ä–∞–∞–ª—å, –í–ª–∞—Å—Ç–µ–ª–∏–Ω –∫–æ–ª–µ—Ü.
10.–ü–æ—Ö–∏—â–µ–Ω–∏–µ
–ü–æ—Ö–∏—Ç–∏—Ç–µ–ª—å; –ü–æ—Ö–∏—â–µ–Ω–Ω—ã–π; –û–ø–µ–∫—É–Ω
–ü–æ—Ö–∏—Ç–∏—Ç–µ–ª—å —É–≤–æ–∑–∏—Ç –ü–æ—Ö–∏—â–µ–Ω–Ω–æ–≥–æ –æ—Ç –û–ø–µ–∫—É–Ω–∞. –ü—Ä–∏–º–µ—Ä: –ï–ª–µ–Ω–∞ –ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è
11.–ó–∞–≥–∞–¥–∫–∞
–ó–∞–≥–∞–¥–∫–∞; –í–æ–ø—Ä–æ—à–∞—é—â–∏–π; –û—Ç–≤–µ—Ç—á–∏–∫
–í–æ–ø—Ä–æ—à–∞—é—â–∏–π –∑–∞–≥–∞–¥—ã–≤–∞–µ—Ç –∑–∞–≥–∞–¥–∫—É –û—Ç–≤–µ—Ç—á–∏–∫—É –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–º—É —à–∞–Ω—Å –¥–æ—Å—Ç–∏—á—å –µ–≥–æ —Ü–µ–ª–µ–π. –ü—Ä–∏–º–µ—Ä—ã: –°—Ñ–∏–Ω–∫—Å, –≠–¥–∏–ø.
12.–û–±—Ä–µ—Ç–µ–Ω–∏–µ
–ü—Ä–æ—Å–∏—Ç–µ–ª—å –∏ –í–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –°—É–¥—å—è –∏ –ü—Ä–µ—Ç–µ–Ω–¥–µ–Ω—Ç—ã
–ü—Ä–æ—Å–∏—Ç–µ–ª—å –≤—Å—Ç—É–ø–∞–µ—Ç –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –í–ª–∞–¥–µ–ª—å—Ü–µ–º, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∞—Ç—å –µ–º—É –ø—Ä–µ–¥–º–µ—Ç —Å–ø–æ—Ä–∞. –í—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç: –°—É–¥—å—è —Ä–µ—à–∞–µ—Ç –∫–æ–º—É –æ—Ç–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç, –æ –∫–æ—Ç–æ—Ä–æ–º —Å–ø–æ—Ä—è—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü—Ä–µ—Ç–µ–Ω–¥–µ–Ω—Ç–æ–≤. –ü—Ä–∏–º–µ—Ä: –Ø–±–ª–æ–∫–æ —Ä–∞–∑–¥–æ—Ä–∞
13.–í—Ä–∞–∂–¥–∞ –º–µ–∂–¥—É –±–ª–∏–∑–∫–∏–º–∏
–ó–ª–æ–±–Ω—ã–π –°–æ—Ä–æ–¥–∏—á –∏ –ù–µ–Ω–∞–≤–∏–¥–∏–º—ã–π –∏–ª–∏ –°–æ—Ä–æ–¥–∏—á–∏, –≤–∑–∞–∏–º–Ω–æ –Ω–µ–Ω–∞–≤–∏–¥—è—â–∏–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
–°–æ—Ä–æ–¥–∏—á–∏ –∑–∞–º—ã—à–ª—è—é—Ç –¥—Ä—É–≥ –ø—Ä–æ—Ç–∏–≤ –¥—Ä—É–≥–∞ –∫–æ–∑–Ω–∏. –ò–ª–∏ –ó–ª–æ–±–Ω—ã–π –°–æ—Ä–æ–¥–∏—á —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –ø–æ–¥—Å–∏–¥–µ—Ç—å –ù–µ–Ω–∞–≤–∏–¥–∏–º–æ–≥–æ. –ü—Ä–∏–º–µ—Ä: –ö–∞–∫ –≤–∞–º —ç—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è
14.–°–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ –º–µ–∂–¥—É –±–ª–∏–∑–∫–∏–º–∏
–õ—é–±–∏–º—ã–π –°–æ—Ä–æ–¥–∏—á; –û—Ç–≤–µ—Ä–≥–Ω—É—Ç—ã–π –°–æ—Ä–æ–¥–∏—á; –ø—Ä–µ–¥–º–µ—Ç —Å–ø–æ—Ä–∞.
–ü—Ä–µ–¥–º–µ—Ç —Å–ø–æ—Ä–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –õ—é–±–∏–º–æ–≥–æ –°–æ—Ä–æ–¥–∏—á–∞ –û—Ç–≤–µ—Ä–≥–Ω—É—Ç–æ–º—É –°–æ—Ä–æ–¥–∏—á—É. –ü—Ä–∏–º–µ—Ä: –ì—Ä–æ–∑–æ–≤–æ–π –ø–µ—Ä–µ–≤–∞–ª.
15.–ê–¥—é–ª—å—Ç–µ—Ä, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—â–∏–π—Å—è —É–±–∏–π—Å—Ç–≤–æ–º
–õ—é–±–æ–≤–Ω–∏–∫–∏; –ù–µ–Ω–∞–≤–∏—Å—Ç–Ω—ã–π –°—É–ø—Ä—É–≥
–î–≤–æ–µ –õ—é–±–æ–≤–Ω–∏–∫–æ–≤ –∑–∞–º—ã—à–ª—è—é—Ç —É–±–∏—Ç—å –ù–µ–Ω–∞–≤–∏—Å—Ç–Ω–æ–≥–æ –°—É–ø—Ä—É–≥–∞ –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö. –ü—Ä–∏–º–µ—Ä—ã: –õ–µ–¥–∏ –ú–∞–∫–±–µ—Ç –ú—Ü–µ–Ω—Å–∫–æ–≥–æ —É–µ–∑–¥–∞, –ö–ª–∏—Ç–µ–º–Ω–µ—Å—Ç—Ä–∞, –≠–≥–∏—Å—Ñ, –î–≤–æ–π–Ω–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.
16.–ë–µ–∑—É–º–∏–µ
–ë–µ–∑—É–º–µ—Ü; –ñ–µ—Ä—Ç–≤–∞.
–ë–µ–∑—É–º–µ—Ü —Å—Ö–æ–¥–∏—Ç —Å —É–º–∞ –∏ —Å–æ–≤–µ—Ä—à–∞–µ—Ç –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –ñ–µ—Ä—Ç–≤—ã. –ü—Ä–∏–º–µ—Ä: –°–∏—è–Ω–∏–µ.
17.–§–∞—Ç–∞–ª—å–Ω–∞—è –Ω–µ–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å
18.–ù–µ–≤–æ–ª—å–Ω–æ–µ –∫—Ä–æ–≤–æ—Å–º–µ—à–µ–Ω–∏–µ
19.–ù–µ–≤–æ–ª—å–Ω–æ–µ —É–±–∏–π—Å—Ç–≤–æ –±–ª–∏–∑–∫–æ–≥–æ
20.–°–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–æ –∏–º—è –∏–¥–µ–∞–ª–∞
21.–°–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ —Ä–∞–¥–∏ –±–ª–∏–∑–∫–∏—Ö
22.–ñ–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –≤—Å–µ–º —Ä–∞–¥–∏ —Å—Ç—Ä–∞—Å—Ç–∏
23.–ñ–µ—Ä—Ç–≤–∞ –±–ª–∏–∑–∫–∏–º –≤–æ –∏–º—è –¥–æ–ª–≥–∞
24.–°–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Ä–∞–≤–Ω—ã—Ö
25.–ê–¥—é–ª—å—Ç–µ—Ä
26.–ó–∞–ø—Ä–µ—Ç–Ω–∞—è –ª—é–±–æ–≤—å
–õ—é–±–æ–≤–Ω–∏–∫ –∏ –≤–æ–∑–ª—é–±–ª–µ–Ω–Ω–∞—è –Ω–∞—Ä—É—à–∞—é—Ç —Ç–∞–±—É, –∑–∞–≤—è–∑—ã–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä: –ó–∏–≥–º—É–Ω–¥ –∏ –µ–≥–æ —Å–µ—Å—Ç—Ä–∞ –≤ –í–∞–ª—å–∫–∏—Ä–∏–∏.
27.–ë–µ—Å—á–µ—Å—Ç–∏–µ –ª—é–±–∏–º–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞
28.–õ—é–±–æ–≤—å, –≤—Å—Ç—Ä–µ—á–∞—é—â–∞—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
29.–õ—é–±–æ–≤—å –∫ –≤—Ä–∞–≥—É
30.–ß–µ—Å—Ç–æ–ª—é–±–∏–µ
31.–ë–æ—Ä—å–±–∞ –ø—Ä–æ—Ç–∏–≤ –±–æ–≥–∞
32.–ë–µ–∑–æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≤–Ω–æ—Å—Ç—å
33.–°—É–¥–µ–±–Ω–∞—è –æ—à–∏–±–∫–∞
34.–£–≥—Ä—ã–∑–µ–Ω–∏—è —Å–æ–≤–µ—Å—Ç–∏
35.–í–Ω–æ–≤—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π
36.–ü–æ—Ç–µ—Ä—è –±–ª–∏–∑–∫–∏—Ö

4 –¢–∏–ø–∞ —Å—é–∂–µ—Ç–æ–≤ –ø–æ –ë–æ—Ä—Ö–µ—Å—É:
1.–ò—Å—Ç–æ—Ä–∏—è –æ–± –æ—Å–∞–∂–¥—ë–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–π —à—Ç—É—Ä–º—É—é—Ç –∏ –æ–±–æ—Ä–æ–Ω—è—é—Ç (–ø—Ä–∏–º–µ—Ä: ¬´–ò–ª–∏–∞–¥–∞¬ª).
2.–ò—Å—Ç–æ—Ä–∏—è –æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ (–ø—Ä–∏–º–µ—Ä: ¬´–û–¥–∏—Å—Å–µ—è¬ª). –ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏—Å—Ç–æ–∫–∞–º.
3.–ò—Å—Ç–æ—Ä–∏—è –æ –ø–æ–∏—Å–∫–µ (–ø—Ä–∏–º–µ—Ä: ¬´–ê—Ä–≥–æ–Ω–∞–≤—Ç—ã¬ª). –í –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ –ø–æ–∏—Å–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã: –æ–¥–Ω–∏ –≥–µ—Ä–æ–∏ –∏—â—É—Ç —Å–µ–±—è, –¥—Ä—É–≥–∏–µ ‚Äî —Å–æ–∫—Ä–æ–≤–∏—â–∞.
4.–ò—Å—Ç–æ—Ä–∏—è –æ —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–µ/—Å–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–∏ –±–æ–≥–∞ (–ø—Ä–∏–º–µ—Ä: –•—Ä–∏—Å—Ç–æ—Å). –ì–ª–∞–≤–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ —Å—Ç—Ä–µ–º–∏—Ç—Å—è —Å—Ç–∞—Ç—å —á–µ–º-—Ç–æ –±–æ–ª—å—à–∏–º, —á–µ–º –æ–Ω –µ—Å—Ç—å, –ø–æ–∑–Ω–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏, —Å–ø–∞—Å—Ç–∏ –º–∏—Ä, –∏ –≥–æ—Ç–æ–≤ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —Å–æ–±–æ–π —Ä–∞–¥–∏ –≤—Å–µ–æ–±—â–µ–≥–æ –±–ª–∞–≥–∞.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥–ª–∞–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
CHAPTER_PROMPT = """
–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å. –ù–∞–ø–∏—à–∏ –≥–ª–∞–≤—É –ø–æ–≤–µ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –£–ñ–ï –ù–ê–ü–ò–°–ê–ù–ù–´–• –ü–†–ï–î–´–î–£–©–ò–• –ì–õ–ê–í.

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
–ñ–∞–Ω—Ä: {genre}
–°–µ—Ç—Ç–∏–Ω–≥: {setting}
{alias_text}

## –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
{structure}

## –£–ñ–ï –ù–ê–ü–ò–°–ê–ù–ù–´–ï –ü–†–ï–î–´–î–£–©–ò–ï –ì–õ–ê–í–´:
{previous_chapters}

## –¢–ï–ö–£–©–ê–Ø –ì–õ–ê–í–ê {chapter_number} - –î–ï–¢–ê–õ–ò:
{chapter_details}

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –û–±—ä–µ–º: –ø—Ä–∏–º–µ—Ä–Ω–æ {word_count} —Å–ª–æ–≤
- –°—Ç–∏–ª—å: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∂–∞–Ω—Ä—É {genre}
- –°—é–∂–µ—Ç: –ù–ï –û–¢–ö–õ–û–ù–Ø–ô–°–Ø –æ—Ç –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –£–ß–¢–ò –í–°–ï –°–û–ë–´–¢–ò–Ø –ò –î–ò–ê–õ–û–ì–ò –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –ì–õ–ê–í
- –û–ë–ï–°–ü–ï–ß–¨ –ü–õ–ê–í–ù–´–ï –ü–ï–†–ï–•–û–î–´ –ò –õ–û–ì–ò–ß–ï–°–ö–£–Æ –ü–†–ï–ï–ú–°–¢–í–ï–ù–ù–û–°–¢–¨
- –†–∞–∑–≤–∏–≤–∞–π —Å—é–∂–µ—Ç–Ω—ã–µ –ª–∏–Ω–∏–∏, –Ω–∞—á–∞—Ç—ã–µ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –†–∞–∑–≤–∏–≤–∞–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –∑–∞–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ
- –ò—Å–ø–æ–ª—å–∑—É–π —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã —Å–æ–≥–ª–∞—Å–Ω–æ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏, —É—á–∏—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –ù–ï –ó–õ–û–£–ü–û–¢–†–ï–ë–õ–Ø–ô –î–ò–ê–õ–û–ì–ê–ú–ò, –ë–û–õ–¨–®–ï –î–ï–ô–°–¢–í–ò–Ø –ò –û–ü–ò–°–ê–ù–ò–ô
- –ú–ï–ù–¨–®–ï –®–¢–ê–ú–ü–û–í –ò –ö–õ–ò–®–ï, –ë–û–õ–¨–®–ï –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–• –ò–î–ï–ô –ò –ù–ï–û–ñ–ò–î–ê–ù–ù–´–• –°–Æ–ñ–ï–¢–ù–´–• –ü–û–í–û–†–û–¢–û–í
- –ù–ï –í–û–°–ü–†–û–ò–ó–í–û–î–ò –í –¢–ï–ö–°–¢–ï –ü–†–û–ú–ü–¢–´ –ò –°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–†–ï–î–´–î–£–©–ò–• –ì–õ–ê–í
- –ò–ó–ë–ï–ì–ê–ô –ù–ï–ù–£–ñ–ù–û–ì–û –ü–ê–§–û–°–ê
- –ò–ó–ë–ï–ì–ê–ô –ù–ï–†–í–û–ó–ù–´–• –ü–û–í–¢–û–†–Ø–Æ–©–ò–•–°–Ø –§–†–ê–ó –í–†–û–î–ï '–û–ù–ê –°–î–ï–õ–ê–õ–ê –≠–¢–û', '–û–ù–ê –ë–´–õ–ê –ì–û–¢–û–í–ê'

–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã {chapter_number}, –Ω–∞—á–∏–Ω–∞—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –ö–û–¢–û–†–û–ï –õ–û–ì–ò–ß–ï–°–ö–ò –í–´–¢–ï–ö–ê–ï–¢ –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –°–û–ë–´–¢–ò–ô.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
EDITOR_PROMPT = """
–¢—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –≥–ª–∞–≤—É –∏ –ø–µ—Ä–µ–ø–∏—à–∏ –µ–µ, –æ–±–æ–≥–∞—Ç–∏–≤ –¥–µ—Ç–∞–ª—è–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π, —á—É–≤—Å—Ç–≤ –∏ –º—ã—Å–ª–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏—Å–ø—Ä–∞–≤–∏–≤ —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

1. –ë—Ä–µ–¥–æ–≤—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–æ —Å–º—ã—Å–ª—É —Ä–µ–ø–ª–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ —Ñ—Ä–∞–∑—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: 
   '- –£ –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å. –ú—ã —Å–º–æ–≥–ª–∏. –ú—ã –ø–æ–±–µ–¥–∏–ª–∏.', 
   '- –ú—ã —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ. –Ø –∏ —Ç—ã. –ú—ã –æ–±–∞'. 
   '–û–Ω–∞ –±—ã–ª–∞ –≥–æ—Ç–æ–≤–∞. –û–Ω –±—ã–ª –≥–æ—Ç–æ–≤. –û–Ω–∏ –æ–±–∞ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã.' 
   –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–¥–Ω—É —Ñ—Ä–∞–∑—É, –æ–±—â—É—é –ø–æ —Å–º—ã—Å–ª—É —Å–æ –≤—Å–µ–π –±—Ä–µ–¥–æ–≤–æ–π —Ü–µ–ø–æ—á–∫–æ–π –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö —Ñ—Ä–∞–∑.

2. –¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ—Å—Ç—É–ø–∫–æ–≤ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: 
   '–û–Ω –≤—Å—Ç—É–ø–∏–ª –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–µ–¥–∏–Ω–æ–∫, –Ω–∞–Ω–µ—Å —É–¥–∞—Ä –∏ –ø–æ–±–µ–¥–∏–ª' 
   –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ –≤—Ä–æ–¥–µ 
   '–û–Ω —É–ø–∞–ª –Ω–∞–≤–∑–Ω–∏—á—å, –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ –∏–∑–≤–µ—Ä–Ω—É–ª—Å—è –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ —Å–æ –≤—Å–µ–π —Å–∏–ª—ã –¥–≤–∏–Ω—É–ª –∫—É–ª–∞–∫–æ–º –≤ –≥—Ä—É–¥—å, –Ω–æ –≤–æ–≤—Ä–µ–º—è –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ –ø–æ–≥–∞—Å–∏–ª —ç–Ω–µ—Ä–≥–∏—é —É–¥–∞—Ä–∞, –∏ –æ–Ω, –≤—Å–∫–æ—á–∏–≤, —Å–¥–µ–ª–∞–ª –ª–æ–≤–∫—É—é –ø–æ–¥—Å–µ—á–∫—É, –ø–æ–≤–∞–ª–∏–≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –Ω–∞ –∑–µ–º–ª—é. –¢–æ—Ç –∑–∞—Ç–∏—Ö –∏ –ø–µ—Ä–µ—Å—Ç–∞–ª –¥–≤–∏–≥–∞—Ç—å—Å—è, —Ç–æ–ª—å–∫–æ –ø–∞—Ä —à–µ–ª –∏–∑–æ —Ä—Ç–∞. –ë–æ–ª—å—à–µ –æ–Ω –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª —É–≥—Ä–æ–∑—ã.'

3. –¢—Ä—é–∏–∑–º—ã, —Ç–∞–≤—Ç–æ–ª–æ–≥–∏—é.

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
–ñ–∞–Ω—Ä: {genre}
–°–µ—Ç—Ç–∏–Ω–≥: {setting}
{alias_text}

## –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
{structure}

## –ü–†–ï–î–´–î–£–©–ò–ï –ì–õ–ê–í–´ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞):
{previous_chapters}

## –¢–ï–ö–£–©–ê–Ø –ì–õ–ê–í–ê {chapter_number} –î–õ–Ø –†–ï–î–ê–ö–¢–£–†–´:
{chapter_text}

## –ó–ê–î–ê–ß–ê:
–ü–µ—Ä–µ–ø–∏—à–∏ –≥–ª–∞–≤—É, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—é–∂–µ—Ç –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è, –Ω–æ —É–ª—É—á—à–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ:
- –û–±–æ–≥–∞—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏—è –¥–µ—Ç–∞–ª—è–º–∏
- –£–≥–ª—É–±–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —á–µ—Ä–µ–∑ –∏—Ö –º—ã—Å–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∞
- –£–±–µ—Ä–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏ —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
- –î–æ–±–∞–≤—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–æ—Ö—Ä–∞–Ω–∏ –æ–±—â–∏–π —Å—Ç–∏–ª—å –∏ —Ç–æ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

–í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ—Ü–µ–Ω–∑–∏–∏ –∫—Ä–∏—Ç–∏–∫–∞
CRITIQUE_PROMPT = """
–ù–∞–ø–∏—à–∏ —Ä–µ—Ü–µ–Ω–∑–∏—é –Ω–∞ –º–æ–π —Ç–µ–∫—Å—Ç:

{full_story}

–¢–≤–æ–π —Ç–æ–Ω ‚Äî —Å—Ç—Ä–æ–≥–∏–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ª–∏—à–µ–Ω–Ω—ã–π —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç–∏.
–¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ ‚Äî —Ç–æ—á–Ω—ã–π –∏ –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π –∫ —Å–ª–∞–±—ã–º –º–µ—Å—Ç–∞–º.
–¢–≤–æ—è –∫—Ä–∏—Ç–∏–∫–∞ –≤—Å–µ–≥–¥–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞. –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—à—å –Ω–∞ –æ—à–∏–±–∫—É, –∞ –æ–±—ä—è—Å–Ω—è–µ—à—å, –ø–æ—á–µ–º—É —ç—Ç–æ –æ—à–∏–±–∫–∞, –∏ –∫–∞–∫ –µ—ë –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.
–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã–Ω–µ—Å–µ–Ω–∏—è –≤–µ—Ä–¥–∏–∫—Ç–æ–≤ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é, —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫—É—é –∏–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –º–µ—Ç–∞—Ñ–æ—Ä–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–î–∏–∞–≥–Ω–æ–∑: ...", "–ü—Ä–æ—Ç–æ–∫–æ–ª –≤—Å–∫—Ä—ã—Ç–∏—è:", "–í–µ—Ä–¥–∏–∫—Ç: ..."). 
–ü–æ—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç—É –æ—Ü–µ–Ω–∫—É –æ—Ç 10 - –æ—Ç–ª–∏—á–Ω–æ –¥–æ 0 - –∫–æ—à–º–∞—Ä–Ω–æ.
"""

def generate_structure(genre, setting, alias, temperature):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–∏ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        prompt = STRUCTURE_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text
        )
        
        model = genai.GenerativeModel('gemini-2.5-flash')
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π
        generation_config = genai.types.GenerationConfig(
            temperature=temperature,
            top_p=0.8,
            top_k=40
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: {str(e)}")
        return None

def generate_chapter(genre, setting, alias, structure, previous_chapters, chapter_number, chapter_details, word_count):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–ª–∞–≤—É –ø–æ–≤–µ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0.3)"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        previous_chapters_text = "–≠—Ç–æ –ø–µ—Ä–≤–∞—è –≥–ª–∞–≤–∞, –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤ –Ω–µ—Ç." if not previous_chapters else previous_chapters
        
        prompt = CHAPTER_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            structure=structure,
            previous_chapters=previous_chapters_text,
            chapter_number=chapter_number,
            chapter_details=chapter_details,
            word_count=word_count
        )
        
        model = genai.GenerativeModel('gemini-2.0-flash')
        
        # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤ - –Ω–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
        generation_config = genai.types.GenerationConfig(
            temperature=0.3,  # –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            top_p=0.7,
            top_k=20
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤—ã {chapter_number}: {str(e)}")
        return None

def literary_edit_chapter(genre, setting, alias, structure, previous_chapters, chapter_number, chapter_text):
    """–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –≥–ª–∞–≤—É —Å –ø–æ–º–æ—â—å—é –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞"""
    try:
        alias_text = f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {alias}" if alias else ""
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        previous_chapters_text = "–≠—Ç–æ –ø–µ—Ä–≤–∞—è –≥–ª–∞–≤–∞, –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤ –Ω–µ—Ç." if not previous_chapters else previous_chapters
        
        prompt = EDITOR_PROMPT.format(
            genre=genre,
            setting=setting,
            alias_text=alias_text,
            structure=structure,
            previous_chapters=previous_chapters_text,
            chapter_number=chapter_number,
            chapter_text=chapter_text
        )
        
        model = genai.GenerativeModel('gemini-2.0-flash')
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ - —Å—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—é–∂–µ—Ç–∞
        generation_config = genai.types.GenerationConfig(
            temperature=0.5,
            top_p=0.8,
            top_k=30
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥–ª–∞–≤—ã {chapter_number}: {str(e)}")
        return chapter_text  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏

def parse_structure_for_chapters(structure_text):
    """–ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–ª–∞–≤–∞—Ö"""
    # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    # –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–¥–∏–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥–ª–∞–≤
    chapters = []
    
    lines = structure_text.split('\n')
    current_chapter = None
    
    for line in lines:
        line = line.strip()
        if line.lower().startswith('–≥–ª–∞–≤–∞') or line.lower().startswith('chapter'):
            if current_chapter:
                chapters.append(current_chapter)
            current_chapter = {"title": line, "details": ""}
        elif current_chapter and line:
            current_chapter["details"] += line + "\n"
    
    if current_chapter:
        chapters.append(current_chapter)
    
    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    if not chapters:
        chapters = [
            {"title": "–ì–ª–∞–≤–∞ 1: –ù–∞—á–∞–ª–æ –ø—É—Ç–∏", "details": "–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –≥–ª–∞–≤–Ω—ã–º –≥–µ—Ä–æ–µ–º –∏ –º–∏—Ä–æ–º"},
            {"title": "–ì–ª–∞–≤–∞ 2: –ü–µ—Ä–≤—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è", "details": "–ì–µ—Ä–æ–π —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤—ã–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏"},
            {"title": "–ì–ª–∞–≤–∞ 3: –†–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞", "details": "–£–≥–ª—É–±–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π"},
            {"title": "–ì–ª–∞–≤–∞ 4: –ü–æ–≤–æ—Ä–æ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç", "details": "–ö–ª—é—á–µ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–Ω—è—é—â–µ–µ —Ö–æ–¥ –∏—Å—Ç–æ—Ä–∏–∏"},
            {"title": "–ì–ª–∞–≤–∞ 5: –ù–∞—Ä–∞—Å—Ç–∞–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è", "details": "–°–∏—Ç—É–∞—Ü–∏—è —É—Å–ª–æ–∂–Ω—è–µ—Ç—Å—è"},
            {"title": "–ì–ª–∞–≤–∞ 6: –ö—Ä–∏–∑–∏—Å", "details": "–ì–µ—Ä–æ–π –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª–æ–∂–Ω–µ–π—à–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏"},
            {"title": "–ì–ª–∞–≤–∞ 7: –†–µ—à–µ–Ω–∏–µ", "details": "–ì–µ—Ä–æ–π –Ω–∞—Ö–æ–¥–∏—Ç –ø—É—Ç—å –∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞"},
            {"title": "–ì–ª–∞–≤–∞ 8: –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è", "details": "–†–∞–∑–≤—è–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π"},
            {"title": "–ì–ª–∞–≤–∞ 9: –§–∏–Ω–∞–ª", "details": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –≤—ã–≤–æ–¥—ã"}
        ]
    
    return chapters

def generate_critique(full_story):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏—é –æ—Ç –±–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –∫—Ä–∏—Ç–∏–∫–∞"""
    try:
        prompt = CRITIQUE_PROMPT.format(full_story=full_story)
        
        model = genai.GenerativeModel('gemini-2.0-flash')
        
        generation_config = genai.types.GenerationConfig(
            temperature=0.7,  # –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
            top_p=0.8,
            top_k=40
        )
        
        response = model.generate_content(
            prompt,
            generation_config=generation_config
        )
        
        return response.text
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–Ω–∑–∏–∏: {str(e)}")
        return None

def main():
    st.set_page_config(
        page_title="–ì—Ä–∞—Ñ–æ–º–∞–Ω—ä: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π",
        page_icon="üìñ",
        layout="wide"
    )
    
    st.title("üìñ –ì—Ä–∞—Ñ–æ–º–∞–Ω—ä: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π")
    st.markdown("–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–≤–µ—Å—Ç–∏ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –∂–∞–Ω—Ä–µ –∏ —Å–µ—Ç—Ç–∏–Ω–≥–µ")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state
    if 'current_step' not in st.session_state:
        st.session_state.current_step = 1  # 1: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, 2: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, 3: —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    if 'full_story' not in st.session_state:
        st.session_state.full_story = ""
    
    if 'edited_story' not in st.session_state:
        st.session_state.edited_story = ""  # –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
    
    if 'critique' not in st.session_state:
        st.session_state.critique = None
    
    if 'is_generating_critique' not in st.session_state:
        st.session_state.is_generating_critique = False
    
    # –®–∞–≥ 1: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤–µ—Å—Ç–∏
    if st.session_state.current_step == 1:
        st.header("1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤–µ—Å—Ç–∏")
        
        col1, col2 = st.columns(2)
        
        with col1:
            genre = st.text_input(
                "–ñ–∞–Ω—Ä –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:",
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ñ—ç–Ω—Ç–µ–∑–∏, –Ω–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤, —Ä–æ–º–∞–Ω...",
                help="–£–∫–∞–∂–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∂–∞–Ω—Ä –≤–∞—à–µ–π –ø–æ–≤–µ—Å—Ç–∏"
            )
        
        with col2:
            setting = st.text_input(
                "–°–µ—Ç—Ç–∏–Ω–≥ (–º–µ—Å—Ç–æ –∏ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è):",
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ, –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è –≤ 2250 –≥–æ–¥—É...",
                help="–û–ø–∏—à–∏—Ç–µ –º–∏—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–µ"
            )
        
        # –ü–æ–ª–∑—É–Ω–æ–∫ —Ñ–∞–Ω—Ç–∞–∑–∏–∏
        st.header("2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞")
        
        creativity = st.slider(
            "–£—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏ –ø–∏—Å–∞—Ç–µ–ª—è:",
            min_value=0.1,
            max_value=1.0,
            value=0.7,
            step=0.1,
            help=(
                "–ù–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—é–∂–µ—Ç, —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä—É\n"
                "–í—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—é–∂–µ—Ç, –≤–æ–∑–º–æ–∂–Ω—ã —Å–º–µ—à–µ–Ω–∏—è –∂–∞–Ω—Ä–æ–≤"
            )
        )
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∫ —É—Ä–æ–≤–Ω—é —Ñ–∞–Ω—Ç–∞–∑–∏–∏
        creativity_descriptions = {
            0.1: "ü§ñ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å - —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–æ–Ω–∞–º –∂–∞–Ω—Ä–∞",
            0.2: "üìö –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤",
            0.3: "üìù –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–µ–∞–ª–∏–∑–º - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å—é –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º", 
            0.4: "üé≠ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–æ–≤–∏–∑–Ω—ã",
            0.5: "‚ú® –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å - —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–µ–π",
            0.6: "üåü –¢–≤–æ—Ä—á–µ—Å–∫–∏–π - –∑–∞–º–µ—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å—é–∂–µ—Ç–µ",
            0.7: "üöÄ –í—ã—Å–æ–∫–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è - –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —à–∞–±–ª–æ–Ω–æ–≤",
            0.8: "üé® –û—á–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π - —Å–º–µ–ª—ã–µ —Å—é–∂–µ—Ç–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è",
            0.9: "üî• –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π",
            1.0: "‚ö° –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—é–∂–µ—Ç"
        }
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        current_description = creativity_descriptions.get(creativity, "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥")
        st.info(f"**–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:** {current_description}")
        
        st.header("3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)")
        alias = st.text_area(
            "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ—è –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:",
            height=100,
            placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏—Å—Ç–æ—Ä–∏—è –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–µ, –ø–æ–ø–∞–≤—à–µ–º –≤ –º–∏—Ä –º–∞–≥–∏–∏, –≥–¥–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∑–∞–º–µ–Ω—è—é—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è...",
            help="–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –∏–¥–µ–∏ –¥–ª—è —Å—é–∂–µ—Ç–∞"
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ session_state
        st.session_state.genre = genre
        st.session_state.setting = setting
        st.session_state.creativity = creativity
        st.session_state.alias = alias
        
        # –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        if st.button("üé≠ –ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Å—Ç–∏", type="primary"):
            if not genre or not setting:
                st.warning("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥")
            else:
                st.session_state.current_step = 2
                st.rerun()
    
    # –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–≤–µ—Å—Ç–∏
    elif st.session_state.current_step == 2:
        genre = st.session_state.genre
        setting = st.session_state.setting
        creativity = st.session_state.creativity
        alias = st.session_state.alias
        
        st.header("üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–≤–µ—Å—Ç–∏")
        st.info(f"**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ñ–∞–Ω—Ä: {genre}, –°–µ—Ç—Ç–∏–Ω–≥: {setting}, –§–∞–Ω—Ç–∞–∑–∏—è: {creativity}")
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        with st.spinner("üìê –°–æ–∑–¥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è..."):
            structure = generate_structure(genre, setting, alias, creativity)
            
            if not structure:
                st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
                if st.button("üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"):
                    st.rerun()
                return
            
            st.success("‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞!")
            
            # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            st.divider()
            st.header("üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
            st.text_area("–°—Ç—Ä—É–∫—Ç—É—Ä–∞:", structure, height=400, key="structure")
        
        # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–ª–∞–≤–∞—Ö
        chapters_info = parse_structure_for_chapters(structure)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª–∞–≤
        st.divider()
        st.header("üñãÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ –≥–ª–∞–≤")
        st.info("üìù –ì–ª–∞–≤—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π 0.3 –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—é–∂–µ—Ç–∞")
        
        full_story = ""
        edited_story = ""  # –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
        progress_bar = st.progress(0)
        status_text = st.empty()
        chapter_display = st.empty()
        
        chapters_count = len(chapters_info)
        words_per_chapter = 8000  # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º –Ω–∞ –≥–ª–∞–≤—É
        
        for chapter_num in range(chapters_count):
            status_text.text(f"–ü–∏—à—É –≥–ª–∞–≤—É {chapter_num + 1} –∏–∑ {chapters_count}...")
            
            # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π –≥–ª–∞–≤–µ
            chapter_info = chapters_info[chapter_num]
            chapter_details = f"{chapter_info['title']}\n{chapter_info['details']}"
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –≥–ª–∞–≤—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            with chapter_display.container():
                st.subheader(f"–ì–ª–∞–≤–∞ {chapter_num + 1}: {chapter_info['title']}")
                st.write(chapter_info['details'])
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥–ª–∞–≤—É —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            chapter_text = generate_chapter(
                genre, setting, alias, structure, 
                full_story,  # –ü–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≥–ª–∞–≤—ã –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç
                chapter_num + 1, 
                chapter_details, 
                words_per_chapter
            )
            
            if chapter_text:
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–ª–∞–≤—É –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                with st.spinner(f"‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä—É—é –≥–ª–∞–≤—É {chapter_num + 1}..."):
                    edited_chapter_text = literary_edit_chapter(
                        genre, setting, alias, structure,
                        full_story,  # –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤
                        chapter_num + 1,
                        chapter_text
                    )
                
                # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≥–ª–∞–≤—É –∫ –ø–æ–ª–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
                full_story += f"\n\n–ì–õ–ê–í–ê {chapter_num + 1}: {chapter_info['title']}\n\n{chapter_text}"
                
                # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≥–ª–∞–≤—É –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
                edited_story += f"\n\n–ì–õ–ê–í–ê {chapter_num + 1}: {chapter_info['title']}\n\n{edited_chapter_text}"
                
                st.success(f"‚úÖ –ì–ª–∞–≤–∞ {chapter_num + 1} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞")
            else:
                st.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –≥–ª–∞–≤—ã {chapter_num + 1}")
                break
            
            progress_bar.progress((chapter_num + 1) / chapters_count)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 3
        if edited_story.strip():
            st.session_state.full_story = full_story  # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
            st.session_state.edited_story = edited_story  # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
            st.session_state.current_step = 3
            st.success("üéâ –ü–æ–≤–µ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞!")
            st.rerun()
    
    # –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Ä–µ—Ü–µ–Ω–∑–∏—è
    elif st.session_state.current_step == 3:
        st.header("üìò –ì–æ—Ç–æ–≤–∞—è –ø–æ–≤–µ—Å—Ç—å")
        
        # –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
        version = st.radio(
            "–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:",
            ["üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)", "‚ö™ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è"],
            index=0
        )
        
        # –í—ã–±–∏—Ä–∞–µ–º –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
        display_story = st.session_state.edited_story if version.startswith("üìù") else st.session_state.full_story
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª–Ω—É—é –ø–æ–≤–µ—Å—Ç—å
        st.text_area("–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–≤–µ—Å—Ç–∏:", display_story, height=600, key="full_story_display")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        word_count = len(display_story.split())
        st.sidebar.header("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
        st.sidebar.write(f"–û–±—â–∏–π –æ–±—ä–µ–º: {word_count} —Å–ª–æ–≤")
        st.sidebar.write(f"–£—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏: {st.session_state.creativity}")
        st.sidebar.write(f"–í–µ—Ä—Å–∏—è: {'–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è' if version.startswith('üìù') else '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è'}")
        
        # –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        st.divider()
        st.header("üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
        
        col1, col2 = st.columns(2)
        
        with col1:
            # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞–∫ TXT
            b64_txt = base64.b64encode(display_story.encode()).decode()
            version_suffix = "_–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è" if version.startswith("üìù") else "_–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è"
            href_txt = f'<a href="data:file/txt;base64,{b64_txt}" download="–ø–æ–≤–µ—Å—Ç—å_{st.session_state.genre}{version_suffix}.txt">üì• –°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT</a>'
            st.markdown(href_txt, unsafe_allow_html=True)
        
        with col2:
            # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            if st.button("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞", key="copy_full"):
                st.code(display_story, language="markdown")
                st.success("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!")

        # –†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –∫—Ä–∏—Ç–∏–∫–∞
        st.divider()
        st.header("üéØ –†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞")
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–µ
        if st.session_state.critique:
            st.subheader("–†–µ—Ü–µ–Ω–∑–∏—è –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞")
            st.text_area("", st.session_state.critique, height=400, key="critique_display")
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
            if st.button("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", key="copy_critique"):
                st.code(st.session_state.critique, language="markdown")
                st.success("–†–µ—Ü–µ–Ω–∑–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!")
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
            if st.button("üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é", key="refresh_critique"):
                st.session_state.critique = None
                st.session_state.is_generating_critique = False
                st.rerun()
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
        elif st.session_state.is_generating_critique:
            with st.spinner("üîç –ö—Ä–∏—Ç–∏–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç"):
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —Ä–µ—Ü–µ–Ω–∑–∏–∏
                critique = generate_critique(st.session_state.edited_story)
                if critique:
                    st.session_state.critique = critique
                    st.session_state.is_generating_critique = False
                    st.success("‚úÖ –†–µ—Ü–µ–Ω–∑–∏—è –≥–æ—Ç–æ–≤–∞!")
                    st.rerun()
                else:
                    st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é")
                    st.session_state.is_generating_critique = False
                    st.rerun()
        
        # –ï—Å–ª–∏ —Ä–µ—Ü–µ–Ω–∑–∏—è –µ—â–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å
        else:
            st.info("""
            **–ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Ä–µ—Ü–µ–Ω–∑–∏—é –Ω–∞ –≤–∞—à—É –ø–æ–≤–µ—Å—Ç—å:**
            - –°—Ç—Ä–æ–≥–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∏–ª—å–Ω—ã—Ö –∏ —Å–ª–∞–±—ã—Ö —Å—Ç–æ—Ä–æ–Ω
            - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
            - –û—Ü–µ–Ω–∫–∞ –ø–æ 10-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ
            - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—Ä–∏—Ç–∏–∫–∞ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π/—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –º–µ—Ç–∞—Ñ–æ—Ä–∏–∫–æ–π
            """)
            
            if st.button("üìù –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é –æ—Ç –ë–µ—Å–ø–æ—â–∞–¥–Ω–æ–≥–æ –ö—Ä–∏—Ç–∏–∫–∞", type="secondary"):
                st.session_state.is_generating_critique = True
                st.rerun()
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –ø–æ–≤–µ—Å—Ç–∏
        st.divider()
        if st.button("üîÑ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–≤–µ—Å—Ç—å", type="primary"):
            # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            st.session_state.current_step = 1
            st.session_state.full_story = ""
            st.session_state.edited_story = ""
            st.session_state.critique = None
            st.session_state.is_generating_critique = False
            st.rerun()

    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
    st.sidebar.header("üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
    st.sidebar.info("""
    **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
    - **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–∑—É–Ω–∫–æ–º (0.1-1.0)
    - **–ì–ª–∞–≤—ã:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.3 –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    - **–†–µ–¥–∞–∫—Ç–æ—Ä:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.5 –¥–ª—è –±–∞–ª–∞–Ω—Å–∞
    
    üî• –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ = –±–æ–ª—å—à–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
    ‚ùÑÔ∏è –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ = –±–æ–ª—å—à–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏
    """)
    
    st.sidebar.header("‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏")
    st.sidebar.info("""
    **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–≤–µ—Å—Ç–µ–π** —Å–æ–∑–¥–∞–µ—Ç –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è 
    –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    
    **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
    1. –£–∫–∞–∂–∏—Ç–µ –∂–∞–Ω—Ä –∏ —Å–µ—Ç—Ç–∏–Ω–≥
    2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏
    3. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–¥–µ—é (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
    4. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Å—Ç–∏"
    5. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    
    **–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è:**
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
    - –ì–ª–∞–≤—ã: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0.3 (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
    - –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä: —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–∞
    - –ö–∞–∂–¥–∞—è –≥–ª–∞–≤–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
    - –û–±—â–∏–π –æ–±—ä–µ–º –≥–ª–∞–≤—ã: ~8000+ —Å–ª–æ–≤
    """)

if __name__ == "__main__":
    main()
